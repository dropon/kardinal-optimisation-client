openapi: 3.0.3

info:
  title: Kardinal ARO API
  version: 2.45.0
  description: This document specifies the REST API of Kardinal ARO v2.
  contact:
    url: 'https://kardinal.ai/'
    email: contact@kardinal.ai

servers:
  - url: /api/v2

security:
  - access_token: []

tags:
  - name: Core
    description: How to login, push a plan and then get a solution.
  - name: Management
    description: Refresh an auth token, check the plan status and state(s), and restart/stop an optimization.
  - name: Authenticate
    description: How to authenticate, and manage the access and refresh tokens.
  - name: GDPR
    description: How to manage GDPR policy.
  - name: User
    description: How to create, retrieve, update and delete users.
  - name: Client
    description: How to manage clients and the associated hierarchical data.
  - name: Country
    description: How to manage countries.
  - name: Region
    description: How to manage regions.
  - name: Agency
    description: How to manage agencies.
  - name: Plan
    description: How to create, retrieve, update and delete plans.
  - name: Resource
    description: How to create, retrieve, update and delete resources in a plan.
  - name: Order
    description: How to create, retrieve, update and delete orders in a plan.
  - name: Solution
    description: How to retrieve solutions and errors related.
  - name: Smart Meeting Appointment
    description: How to obtain time windows for a smart meeting appointment.
  - name: Webhook
    description: How to create, retrieve, update and delete webhooks.
  - name: SimplePlan
    description: How to create a plan through the use of a simple plan.

paths:
  /public_key:
    get:
      security: []
      summary: Get the public key which can be used to check the tokens
      operationId: getPublicKey
      tags:
        - Authenticate
      responses:
        '200':
          description: The content of the public key, either in JWK or PEM format.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicKeyJWK'
            text/plain:
              schema:
                $ref: '#/components/schemas/PublicKeyPEM'

  /auth/password/requestToken:
    post:
      summary: Request a password token
      operationId: postRequestPasswordToken
      tags:
        - Authenticate
      security: []
      parameters:
        - $ref: '#/components/parameters/originHeader'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsernameRequest'
      responses:
        '204':
          description: |
            The request has been taken into account.
            If the provided username is a valid email address which corresponds to an active user, a password token will be generated and sent by mail.
            If no active user is found, the error is silently discarded and a 204 code is returned anyway.
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/password/validateToken:
    post:
      summary: Check if a password token is valid
      operationId: validatePasswordToken
      tags:
        - Authenticate
      security: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenRequest'
      responses:
        '204':
          description: The token has been validated.
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/password/reset:
    post:
      summary: Reset a password for a user
      operationId: resetPassword
      tags:
        - Authenticate
      security:
        - password_token: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordRequest'
      responses:
        '204':
          description: The password has been reset.
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/mfa/config:
    get:
      summary: Fetch the actor's MFA config
      operationId: getActorMFAConfig
      tags:
        - Authenticate
      responses:
        '200':
          description: The actor's MFA config.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedMFAConfig'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/mfa/disable:
    post:
      summary: Disable an OTP type in the actor's MFA config
      operationId: disableMFAConfig
      tags:
        - Authenticate
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/MFAConfigRequestEmail'
                - $ref: '#/components/schemas/MFAConfigRequestSMS'
                - $ref: '#/components/schemas/MFAConfigRequestTOTP'
      responses:
        '200':
          description: The updated MFA config.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedMFAConfig'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/mfa/request:
    post:
      summary: Request the update of the actor's MFA config
      operationId: requestMFAConfigUpdate
      tags:
        - Authenticate
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/MFAConfigRequestEmail'
                - $ref: '#/components/schemas/MFAConfigRequestSMS'
                - $ref: '#/components/schemas/MFAConfigRequestTOTP'
      responses:
        '200':
          description: The OTP token valid for 10 minutes.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/EnvelopedMFARequestOTPOutput'
                  - $ref: '#/components/schemas/EnvelopedMFARequestTOTPOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/mfa/resendOTP:
    post:
      security:
        - otp_token: []
      summary: Request a new OTP code for the MFA config update validation
      operationId: requestNewMFAOTPCode
      tags:
        - Authenticate
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/MFAConfigResendEmail'
                - $ref: '#/components/schemas/MFAConfigResendSMS'
      responses:
        '204':
          description: The OTP code was resent.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          description: Too many requests.
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/mfa/validate:
    post:
      security:
        - otp_token: []
      summary: Validate the update of the actor's MFA config
      operationId: validateMFAConfigUpdate
      tags:
        - Authenticate
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/MFAConfigValidationEmail'
                - $ref: '#/components/schemas/MFAConfigValidationSMS'
                - $ref: '#/components/schemas/MFAConfigValidationTOTP'
      responses:
        '200':
          description: The updated MFA config.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedMFAConfig'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/mfa/preferredType:
    put:
      summary: Sets the actor's preferred OTP type in his MFA config
      operationId: putMFAConfigPreferredType
      tags:
        - Authenticate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OTPType'
      responses:
        '200':
          description: The actor's MFA config preferred OTP type was set.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedOTPType'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /auth/mfa/regenerateBackupCodes:
    put:
      summary: Regenerate the actor's backup codes
      operationId: regenerateMFABackupCodes
      tags:
        - Authenticate
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MFAConfigRegenerateBackupCodes'
      responses:
        '200':
          description: The updated MFA config.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedBackupCodes'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /login/methods:
    get:
      summary: Retrieve the available login methods for a given username
      operationId: getLoginMethods
      tags:
        - Authenticate
      security: []
      parameters:
      - $ref: '#/components/parameters/username'
      responses:
        '200':
          description: Authentication methods collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAuthenticationMethods'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /login:
    post:
      summary: Login (returns an OTP token if MFA is configured for the user)
      operationId: postLogin
      tags:
        - Core
        - Authenticate
      security: []
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Login'
      responses:
        '200':
          description: The login succeeded.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/EnvelopedLoginOTPOutput'
                  - $ref: '#/components/schemas/EnvelopedLoginGDPROutput'
                  - $ref: '#/components/schemas/EnvelopedLoginMFAOutput'
                  - $ref: '#/components/schemas/EnvelopedLoginAccessOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /login/otp:
    post:
      summary: Confirm login with OTP
      operationId: postLoginOTP
      tags:
        - Core
        - Authenticate
      security:
        - otp_token: []
      parameters: [ ]
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/LoginOTPInput'
                - $ref: '#/components/schemas/LoginBackupCodeInput'
      responses:
        '200':
          description: The login succeeded.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/EnvelopedLoginGDPROutput'
                  - $ref: '#/components/schemas/EnvelopedLoginAccessOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /login/resendOTP:
    post:
      summary: Request a new OTP code for login
      operationId: requestNewLoginOTPCode
      tags:
        - Authenticate
      security:
        - otp_token: []
      responses:
        '204':
          description: The OTP code was resent.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          description: Too many requests.
        '500':
          $ref: '#/components/responses/InternalServerError'

  /login/refresh:
    post:
      summary: Refresh the access token
      operationId: postLoginRefresh
      tags:
        - Management
        - Authenticate
      security:
        - refresh_token: []
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              description: The old access token.
              properties:
                access_token:
                  $ref: '#/components/schemas/AccessToken'
      responses:
        '200':
          description: The refresh succeeded.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/EnvelopedLoginGDPROutput'
                  - $ref: '#/components/schemas/EnvelopedLoginRefreshOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /login/sso/azure:
    post:
      summary: Login with Azure SSO
      operationId: postLoginWithAzureSSO
      tags:
        - Authenticate
      security: [ ]
      parameters: [ ]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AzureSSOLogin'
      responses:
        '200':
          description: The login succeeded.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/EnvelopedLoginGDPROutput'
                  - $ref: '#/components/schemas/EnvelopedLoginAccessOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /login/sso/google:
    post:
      summary: Login with Google SSO
      operationId: postLoginWithGoogleSSO
      tags:
        - Authenticate
      security: [ ]
      parameters: [ ]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GoogleSSOLogin'
      responses:
        '200':
          description: The login succeeded.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/EnvelopedLoginGDPROutput'
                  - $ref: '#/components/schemas/EnvelopedLoginAccessOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gdpr/approve:
    patch:
      summary: Approve a GDPR policy
      operationId: patchGDPRApprove
      tags:
        - GDPR
      security:
        - gdpr_token: []
      parameters: [ ]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GDPRApproval'
      responses:
        '200':
          description: The GDPR approval succeeded and the login process was finalized.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedLoginAccessOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /users:
    post:
      summary: Creates a single user
      operationId: postUser
      tags:
        - User
      parameters:
        - $ref: '#/components/parameters/originHeader'
      requestBody:
        description: A user entity contains the following informations.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201':
          description: The user was created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedUser'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      summary: Retrieves a collection of users
      operationId: getUsers
      tags:
        - User
      parameters: []
      responses:
        '200':
          description: Users collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedUsers'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /users/api:
    post:
      summary: Creates a user with simpleApi or complexApi usage
      operationId: postUserApi
      tags:
        - User
      parameters:
        - $ref: '#/components/parameters/originHeader'
      requestBody:
        description: |
          An input which allows to create a user with simpleApi or complexApi usage, the associated client, and the client hierarchy.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserAPIInput'
      responses:
        '201':
          description: The simpleApi/complexApi user was created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedUserAPIOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/users/isAvailable/username':
    put:
      summary: Checks the availability of a username
      operationId: putIsAvailableUsername
      tags:
        - User
      requestBody:
        description: The username to check.
        content:
          application/json:
            schema:
              type: string
      responses:
        '200':
          description: The username is available (in this case, the output contains the normalized available username).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedString'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/users/me':
    get:
      summary: Retrieves the current user
      operationId: getMe
      tags:
        - User
      responses:
        '200':
          description: User response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedUser'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/users/{id}':
    parameters:
      - $ref: '#/components/parameters/id'
    get:
      summary: Retrieves a single user
      operationId: getUser
      tags:
        - User
      responses:
        '200':
          description: User response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedUser'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Updates a single user
      operationId: putUser
      tags:
        - User
      requestBody:
        description: The user to update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: The user was updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedUser'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Deletes a single user
      operationId: deleteUser
      tags:
        - User
      responses:
        '204':
          description: The user was deleted.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /clients:
    post:
      summary: Creates a single client
      description: |
        The creation of a client does not take into account the sub-objects, such as the client's countries.
        The creation of these sub-objects will be handled by specific endpoints,
        such as `POST /clients/{cliendId}/countries` for instance.
      operationId: postClient
      tags:
        - Client
      parameters: []
      requestBody:
        description: A client entity contains the following informations.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClientForCreation'
      responses:
        '201':
          description: The client was created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedClient'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      summary: Retrieves the clients which are visible by the current user
      description: |
        By default, the clients' countries, regions and agencies are not provided.
        They can be included thanks to the "untilLevel" query parameter, which can be set to one of the following values:
        - "country": the resulting clients will contain their countries, without regions,
        - "region": the resulting clients will contain their countries and regions, without agencies,
        - "agency": the resulting clients will contain their countries, regions and agencies.
      operationId: getClients
      tags:
        - Client
      parameters:
        - $ref: '#/components/parameters/untilLevel'
      responses:
        '200':
          description: Clients collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedClients'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/isAvailable/name':
    put:
      summary: Checks the availability of a client name
      operationId: putIsAvailableClientName
      tags:
        - Client
      requestBody:
        description: The client name to check.
        content:
          application/json:
            schema:
              type: string
      responses:
        '200':
          description: The client name is available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedString'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/isAvailable/prefix':
    put:
      summary: Checks the availability of a client prefix
      operationId: putIsAvailableClientPrefix
      tags:
        - Client
      requestBody:
        description: The client prefix to check.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClientPrefix'
      responses:
        '200':
          description: The client prefix is available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedString'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}':
    parameters:
      - $ref: '#/components/parameters/clientId'
    get:
      summary: Retrieves a single client
      description: |
        By default, the client's countries, regions and agencies are not provided.
        They can be included thanks to the "untilLevel" query parameter, which can be set to one of the following values:
        - "country": the resulting client will contain its countries, without regions,
        - "region": the resulting client will contain its countries and regions, without agencies,
        - "agency": the resulting client will contain its countries, regions and agencies.
      operationId: getClient
      tags:
        - Client
      parameters:
        - $ref: '#/components/parameters/untilLevel'
      responses:
        '200':
          description: Client response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedClient'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Updates or creates a single client
      operationId: putClient
      description: |
        The update or creation of a client does not take into account the sub-objects, such as the client's countries.
        The update or creation of these sub-objects will be handled by specific endpoints,
        such as `PUT /clients/{cliendId}/countries/{countryId}` for instance.
      tags:
        - Client
      requestBody:
        description: The client to update / create.
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/ClientForUpdate'
                - $ref: '#/components/schemas/ClientForCreation'
      responses:
        '200':
          description: The client was updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedClient'
        '201':
          description: The client was created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedClient'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Deletes an existing client
      operationId: deleteClient
      tags:
        - Client
      responses:
        '204':
          description: The client was deleted and no content is returned.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/countries':
    parameters:
      - $ref: '#/components/parameters/clientId'
    get:
      summary: Retrieves the countries of a single client (including their regions and agencies)
      operationId: getClientCountries
      tags:
        - Client
        - Country
      responses:
        '200':
          description: Countries collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedCountries'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Creates a new country
      operationId: postClientCountry
      tags:
        - Client
        - Country
      requestBody:
        description: A country entity.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CountryForCreation'
      responses:
        '201':
          description: Country response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlainCountry'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/countries/{countryId}':
    parameters:
      - $ref: '#/components/parameters/clientId'
      - $ref: '#/components/parameters/countryId'
    put:
      summary: Updates an existing country or creates a new one if it doesn't exist
      operationId: putClientCountry
      tags:
        - Client
        - Country
      requestBody:
        description: A country entity.
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/CountryForUpdate'
                - $ref: '#/components/schemas/CountryForCreation'
      responses:
        '200':
          description: Country response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlainCountry'
        '201':
          description: Country response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlainCountry'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Deletes an existing country
      operationId: deleteClientCountry
      tags:
        - Client
        - Country
      responses:
        '204':
          description: The country was deleted and no content is returned.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/countries/{countryId}/regions':
    parameters:
      - $ref: '#/components/parameters/clientId'
      - $ref: '#/components/parameters/countryId'
    post:
      summary: Creates a new region
      operationId: postClientRegion
      tags:
        - Client
        - Region
      requestBody:
        description: A region entity.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegionForCreation'
      responses:
        '201':
          description: Region response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlainRegion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/countries/{countryId}/regions/{regionId}':
    parameters:
      - $ref: '#/components/parameters/clientId'
      - $ref: '#/components/parameters/countryId'
      - $ref: '#/components/parameters/regionId'
    put:
      summary: Updates an existing region or creates a new one if it doesn't exist
      operationId: putClientRegion
      tags:
        - Client
        - Region
      requestBody:
        description: A region entity.
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/RegionForUpdate'
                - $ref: '#/components/schemas/RegionForCreation'
      responses:
        '200':
          description: Region response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlainRegion'
        '201':
          description: Region response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlainRegion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Deletes an existing region
      operationId: deleteClientRegion
      tags:
        - Client
        - Region
      responses:
        '204':
          description: The region was deleted and no content is returned.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/countries/{countryId}/regions/{regionId}/agencies':
    parameters:
      - $ref: '#/components/parameters/clientId'
      - $ref: '#/components/parameters/countryId'
      - $ref: '#/components/parameters/regionId'
    post:
      summary: Creates a new agency
      operationId: postClientAgency
      tags:
        - Client
        - Agency
      requestBody:
        description: An agency entity.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgencyForCreation'
      responses:
        '201':
          description: Agency response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgency'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/countries/{countryId}/regions/{regionId}/agencies/{agencyId}':
    parameters:
      - $ref: '#/components/parameters/clientId'
      - $ref: '#/components/parameters/countryId'
      - $ref: '#/components/parameters/regionId'
      - $ref: '#/components/parameters/agencyId'
    put:
      summary: Updates an existing agency or creates a new one if it doesn't exist
      operationId: putClientAgency
      tags:
        - Client
        - Agency
      requestBody:
        description: An agency entity.
        content:
          application/json:
            schema:
              oneOf:
                - $ref: '#/components/schemas/AgencyForUpdate'
                - $ref: '#/components/schemas/AgencyForCreation'
      responses:
        '200':
          description: Agency response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgency'
        '201':
          description: Agency response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgency'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Deletes an existing agency
      operationId: deleteClientAgency
      tags:
        - Client
        - Agency
      responses:
        '204':
          description: The agency was deleted and no content is returned.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/regions':
    parameters:
      - $ref: '#/components/parameters/clientId'
    get:
      summary: Retrieves the regions of a single client (including their agencies)
      operationId: getClientRegions
      tags:
        - Client
        - Region
      responses:
        '200':
          description: Regions collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedRegions'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/agencies':
    parameters:
      - $ref: '#/components/parameters/clientId'
    get:
      summary: Retrieves the agencies of a single client
      operationId: getClientAgencies
      tags:
        - Client
        - Agency
      responses:
        '200':
          description: Agencies collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgencies'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/clients/{clientId}/conf':
    parameters:
      - $ref: '#/components/parameters/clientId'
    get:
      summary: Retrieves the conf of a single client
      operationId: getClientConf
      tags:
        - Client
      responses:
        '200':
          description: Client conf response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedClientConf'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Updates the conf of a single client
      operationId: putClientConf
      tags:
        - Client
      requestBody:
        description: The client conf to update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClientConf'
      responses:
        '200':
          description: The client conf was updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedClientConf'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/countries':
    get:
      summary: Retrieves the countries which are visible by the current user
      description: |
        By default, the countries' regions and agencies are not provided.
        They can be included thanks to the "untilLevel" query parameter, which can be set to one of the following values:
        - "region": the resulting countries will contain their regions, without agencies,
        - "agency": the resulting countries will contain their regions and agencies.
      operationId: getCountries
      tags:
        - Country
      parameters:
        - $ref: '#/components/parameters/untilLevel'
      responses:
        '200':
          description: Countries collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedCountries'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/countries/{countryId}':
    parameters:
      - $ref: '#/components/parameters/countryId'
    delete:
      summary: Deletes an existing country
      operationId: deleteCountry
      tags:
        - Country
      responses:
        '204':
          description: The country was deleted and no content is returned.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/regions':
    get:
      summary: Retrieves the regions which are visible by the current user
      description: |
        By default, the regions' agencies are not provided.
        They can be included thanks to the "untilLevel" query parameter, which can be set to the following value:
        - "agency": the resulting regions will contain their agencies,
      operationId: getRegions
      tags:
        - Region
      parameters:
        - $ref: '#/components/parameters/untilLevel'
      responses:
        '200':
          description: Regions collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedRegions'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/regions/{regionId}':
    parameters:
      - $ref: '#/components/parameters/regionId'
    delete:
      summary: Deletes an existing region
      operationId: deleteRegion
      tags:
        - Region
      responses:
        '204':
          description: The region was deleted and no content is returned.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/agencies':
    get:
      summary: Retrieves the agencies which are visible by the current user
      operationId: getAgencies
      tags:
        - Agency
      responses:
        '200':
          description: Agencies collection response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgencies'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/agencies/{agencyId}':
    parameters:
      - $ref: '#/components/parameters/agencyId'
    delete:
      summary: Deletes an existing agency
      operationId: deleteAgency
      tags:
        - Agency
      responses:
        '204':
          description: The agency was deleted and no content is returned.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  '/agencies/{agencyId}/conf/globalTravelTimeCoefficient':
    parameters:
      - $ref: '#/components/parameters/agencyId'
    put:
      summary: Updates the agency's configured global travel time coefficient configuration
      operationId: putAgencyConfGlobalTravelTimeCoefficient
      tags:
        - Agency
        - Management
      requestBody:
        description: The floating value for the coefficient.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GlobalTravelTimeCoefficient'
      responses:
        '200':
          description: The applied floating value for the coefficient.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedGlobalTravelTimeCoefficient'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Resets the agency's configured global travel time coefficient
      operationId: deleteAgencyConfGlobalTravelTimeCoefficient
      tags:
        - Agency
        - Management
      responses:
        '204':
          description: The agency's configured global travel time coefficient was reset and no content is returned.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans:
    parameters:
      - $ref: '#/components/parameters/agencyId'
    get:
      summary: Retrieves a collection of plans
      description: |
        At the moment, retrieving a collection of plans is not paginated by default.
        The paging is performed when at least one of the paging query parameters (`page` or `itemsPerPage`) is
        present with a valid value.
        The default values are used like this:
        - if `page` is present and `itemsPerPage` is absent, the paging is performed with a default value for `itemsPerPage`,
        - if `itemsPerPage` is present and `page` is absent, the paging is performed with a default value for `page`,
        - but if both `page` and `itemsPerPage` are absent, no paging is performed.
      operationId: getPlans
      tags:
        - Plan
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/itemsPerPage'
        - $ref: '#/components/parameters/archived'
      responses:
        '200':
          description: Plan collection response in a light representation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlansLight'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    get:
      summary: Retrieve a plan
      operationId: getPlan
      tags:
        - Plan
      parameters:
        - $ref: '#/components/parameters/planMode'
      responses:
        '200':
          description: Plan response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlan'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      summary: Create or update a plan
      operationId: putPlan
      tags:
        - Core
        - Plan
      parameters:
        - $ref: '#/components/parameters/force'
      requestBody:
        description: The Plan to update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Plan'
      responses:
        '200':
          description: Plan response updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlan'
        '201':
          description: Plan response created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlan'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Delete a plan
      operationId: deletePlan
      tags:
        - Plan
      responses:
        '204':
          description: Plan is deleted and no content is returned.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/running:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    put:
      summary: Stop or restart the optimization of a plan
      operationId: putPlanRunning
      tags:
        - Management
        - Plan
      parameters:
        - $ref: '#/components/parameters/force'
      requestBody:
        description: "A boolean value: false will stop the optimization, true will restart the optimization."
        content:
          application/json:
            schema:
              type: boolean
              example: false
      responses:
        '200':
          description: The request succeeded.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/resources/{resourceId}:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
      - $ref: '#/components/parameters/resourceId'
    get:
      summary: Retrieve a plan's resource
      operationId: getPlanResource
      tags:
        - Resource
      responses:
        '200':
          description: Resource response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedResource'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      summary: Create or update a plan's resource
      operationId: putPlanResource
      tags:
        - Resource
      parameters:
        - $ref: '#/components/parameters/force'
      requestBody:
        description: The Resource to update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Resource'
      responses:
        '200':
          description: Resource response updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedResource'
        '201':
          description: Resource response created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedResource'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Delete a plan's resource
      operationId: deletePlanResource
      tags:
        - Resource
      parameters:
        - $ref: '#/components/parameters/force'
      responses:
        '204':
          description: Resource is deleted and No content is returned.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/resources/{resourceId}/state:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
      - $ref: '#/components/parameters/resourceId'
    get:
      summary: Retrieve a plan's resource state
      operationId: getPlanResourceState
      tags:
        - Resource
      responses:
        '200':
          description: State response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedState'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      summary: Update a plan's resource state
      operationId: putPlanResourceState
      tags:
        - Resource
      parameters:
        - $ref: '#/components/parameters/force'
      requestBody:
        description: The State to update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/State'
      responses:
        '200':
          description: State response updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedState'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/resources/{resourceId}/forbid/{stopId}:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
      - $ref: '#/components/parameters/resourceId'
      - $ref: '#/components/parameters/stopId'
    put:
      summary: Forbid a resource from doing a stop, and return the updated plan
      description: |
        Forbidding a resource from doing a stop is performed internally by adding a forbidden assignment in the
        list of additional constraints of the plan. The forbidden assignment relies on:
        - a generated resource tag, based on the id of the resource (example: `generatedTag:$resource-2$:forbid`),
        - a generated stop tag, based on the id of the parent order of the stop (example: `generatedTag:$order-1$:forbid`).
        
        Important: all the sibling stops receive this same stop tag, which means that **all the stops of
        the order become forbidden for the resource**.
      operationId: putForbidResourceStop
      tags:
        - Resource
      parameters:
        - $ref: '#/components/parameters/force'
      responses:
        '200':
          description: Updated plan response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlan'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/orders/{orderId}:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
      - $ref: '#/components/parameters/orderId'
    get:
      summary: Retrieve a plan's order
      operationId: getPlanOrder
      tags:
        - Order
      responses:
        '200':
          description: Order response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedOrder'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    put:
      summary: Create or update a plan's order
      operationId: putPlanOrder
      tags:
        - Order
      parameters:
        - $ref: '#/components/parameters/force'
      requestBody:
        description: The Order to update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Order'
      responses:
        '200':
          description: Order response updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedOrder'
        '201':
          description: Order response created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedOrder'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Delete a plan's order
      operationId: deletePlanOrder
      tags:
        - Order
      parameters:
        - $ref: '#/components/parameters/force'
      responses:
        '204':
          description: Order is deleted and no content is returned.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/solution:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    get:
      summary: Retrieve a plan solution
      operationId: getPlanSolution
      tags:
        - Core
        - Plan
        - Solution
      responses:
        '200':
          description: Solution response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedSolution'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/solution/objectives:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    get:
      summary: Retrieve the objectives of a plan solution
      operationId: getPlanSolutionObjectives
      tags:
        - Plan
        - Solution
      responses:
        '200':
          description: Solution objectives response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedSolutionObjectives'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/state:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    get:
      summary: Fetch the latest state of a plan
      operationId: fetchLastPlanState
      tags:
        - Management
        - Plan
      responses:
        '200':
          description: Latest plan state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedTimedPlanState'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/states:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
      - $ref: '#/components/parameters/limit'
    get:
      summary: Fetch the latest states of a plan
      operationId: fetchLastNPlanStates
      tags:
        - Management
        - Plan
      responses:
        '200':
          description: Latest plan states.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedTimedPlanStates'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/status:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    get:
      summary: Retrieve a plan status
      operationId: getPlanStatus
      tags:
        - Management
        - Plan
      responses:
        '200':
          description: Plan status response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlanStatus'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/mode:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    put:
      summary: Changes a plan's mode
      description: |
        By default, a plan is in "standard" mode: the solution is entirely built by the OR algorithms, following the various plan constraints.
        It is possible to switch the plan in "manual" mode: in this mode, the user can force some assignments which may violate some constraints.
      operationId: putPlanMode
      tags:
        - Plan
      parameters:
        - $ref: '#/components/parameters/force'
      requestBody:
        description: The mode to set.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlanMode'
      responses:
        '200':
          description: Plan mode response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlanMode'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/manual/check:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    get:
      summary: Check if a plan is in manual mode
      operationId: checkPlanManualMode
      tags:
        - Plan
      responses:
        '200':
          description: Check response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedBoolResponse'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/timeWindowScoring:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
    post:
      summary: Post an order to obtain time windows for a smart meeting appointment
      tags:
        - Smart Meeting Appointment
      operationId: postSmaScoring
      requestBody:
        description: The smart meeting appointment input.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SMAInput'
      responses:
        '200':
          description: The smart meeting appointment output.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedSMAOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/sectorMapping:
    parameters:
      - $ref: '#/components/parameters/agencyId'

    get:
      summary: Get the sector mapping which is currently applied in an agency, if it exists
      tags:
        - Agency
      operationId: getAgencySectorMapping
      responses:
        '200':
          description: The sector mapping.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedSectorMapping'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Put the sector mapping to be applied in an agency
      tags:
        - Agency
      operationId: putAgencySectorMapping
      requestBody:
        description: The sector mapping to be applied.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SectorMapping'
      responses:
        '200':
          description: The sector mapping was updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedSectorMapping'
        '201':
          description: The sector mapping was created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedSectorMapping'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/timeWindowScoring:
    parameters:
      - $ref: '#/components/parameters/agencyId'
    post:
      summary: Post an order to obtain time windows for a smart meeting appointment in multiple plans of an agency
      tags:
        - Smart Meeting Appointment
      operationId: postSmaMultiPlanScoring
      requestBody:
        description: The smart meeting appointment multi plans input.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SMAMultiPlanInput'
      responses:
        '200':
          description: The smart meeting appointment output.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedSMAOutput'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/webhooks:
    parameters:
      - $ref: '#/components/parameters/agencyId'

    post:
      summary: Create a new agency webhook
      tags:
        - Webhook
      operationId: createAgencyWebhook
      requestBody:
        description: The webhook for creation.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookCreate'
      responses:
        '201':
          description: The created webhook.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgencyWebhook'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      summary: Fetch all agency webhooks
      tags:
        - Webhook
      operationId: fetchAgencyWebhooks
      responses:
        '200':
          description: The found webhooks.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgencyWebhooks'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/webhooks/{webhookId}:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/webhookId'

    get:
      summary: Fetch a single agency webhook
      tags:
        - Webhook
      operationId: fetchAgencyWebhook
      responses:
        '200':
          description: The found webhook.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgencyWebhook'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Updates an existing agency webhook
      tags:
        - Webhook
      operationId: updateAgencyWebhook
      requestBody:
        description: The webhook for update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookUpdate'
      responses:
        '200':
          description: The updated webhook.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgencyWebhook'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Deletes a single agency webhook
      tags:
        - Webhook
      operationId: deleteAgencyWebhook
      responses:
        '204':
          description: No content response.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/webhooks/{webhookId}/results:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/webhookId'

    get:
      summary: Fetch an agency webhook's list of results
      tags:
        - Webhook
      operationId: fetchAgencyWebhookResults
      responses:
        '200':
          description: The found webhook results.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedAgencyWebhookResults'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/webhooks:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'

    post:
      summary: Create a new plan webhook
      tags:
        - Webhook
      operationId: createPlanWebhook
      requestBody:
        description: The webhook for creation.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookCreate'
      responses:
        '201':
          description: The created webhook.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlanWebhook'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      summary: Fetch all plan webhooks
      tags:
        - Webhook
      operationId: fetchPlanWebhooks
      responses:
        '200':
          description: The found webhooks.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlanWebhooks'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/webhooks/{webhookId}:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
      - $ref: '#/components/parameters/webhookId'

    get:
      summary: Fetch a single plan webhook
      tags:
        - Webhook
      operationId: fetchPlanWebhook
      responses:
        '200':
          description: The found webhook.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlanWebhook'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Updates an existing plan webhook
      tags:
        - Webhook
      operationId: updatePlanWebhook
      requestBody:
        description: The webhook for update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookUpdate'
      responses:
        '200':
          description: The updated webhook.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlanWebhook'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Deletes a single plan webhook
      tags:
        - Webhook
      operationId: deletePlanWebhook
      responses:
        '204':
          description: No content response.
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/plans/{planId}/webhooks/{webhookId}/results:
    parameters:
      - $ref: '#/components/parameters/agencyId'
      - $ref: '#/components/parameters/planId'
      - $ref: '#/components/parameters/webhookId'

    get:
      summary: Fetch a plan webhook's list of results
      tags:
        - Webhook
      operationId: fetchPlanWebhookResults
      responses:
        '200':
          description: The found webhook results.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedPlanWebhookResults'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /agencies/{agencyId}/simplePlans:
    parameters:
      - $ref: '#/components/parameters/agencyId'

    post:
      summary: Create a simple plan
      operationId: postSimplePlan
      tags:
        - SimplePlan
      requestBody:
        description: The SimplePlan to create.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SimplePlan'
      responses:
        '201':
          description: The simple plan was created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopedSimplePlan'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/NotAuthenticated'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    otp_token:
      type: http
      scheme: bearer
      bearerFormat: JWT
    gdpr_token:
      type: http
      scheme: bearer
      bearerFormat: JWT
    access_token:
      type: http
      scheme: bearer
      bearerFormat: JWT
    refresh_token:
      type: http
      scheme: bearer
      bearerFormat: JWT
    password_token:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    BadRequest:
      description: The server could not understand the request due to invalid content (bad syntax, bad format, bad values, etc).
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopedErrors'
    NotAuthenticated:
      description: The caller is not authenticated.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopedErrors'
    Unauthorized:
      description: The caller is not authorized to perform this action.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopedErrors'
    Forbidden:
      description: The caller is not allowed to perform this action.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopedErrors'
    NotFound:
      description: The specified resource was not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopedErrors'
    ApiViolations:
      description: The payload you send is unprocessable because of some violations.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopedErrors'
    InternalServerError:
      description: An internal server error has occurred.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopedErrors'

  parameters:
    id:
      name: id
      description: 'Internal identifier: the id which was returned by the POST request.'
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/RegexIdValidation'
    username:
      name: username
      description: The username.
      in: query
      required: false
      schema:
        $ref: '#/components/schemas/Username'
    clientId:
      name: clientId
      description: The client id.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/ClientId'
    countryId:
      name: countryId
      description: The country id.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/CountryId'
    regionId:
      name: regionId
      description: The region id.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/RegionId'
    untilLevel:
      name: untilLevel
      description: The depth level.
      in: query
      required: false
      schema:
        type: string
        enum:
          - country
          - region
          - agency
    agencyId:
      name: agencyId
      description: The agency id.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/AgencyId'
    planId:
      name: planId
      description: The plan id.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/RegexIdValidation'
    resourceId:
      name: resourceId
      description: The resource id.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/RegexIdValidation'
    orderId:
      name: orderId
      description: The order id.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/RegexIdValidation'
    stopId:
      name: stopId
      description: The stop id.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/RegexIdValidation'
    webhookId:
      name: webhookId
      description: The webhook UUID.
      in: path
      required: true
      schema:
        $ref: '#/components/schemas/UUID'
    originHeader:
      name: originHeader
      description: |
        The origin of the request.
        When an email needs to be sent, the "Origin" header value is used (after
        validation) to correctly generate the hyperlinks inside the email body.
      in: header
      schema:
        type: string
        format: uri
    planMode:
      name: mode
      description: The plan mode.
      in: query
      schema:
        $ref: '#/components/schemas/PlanMode'
    limit:
      name: limit
      description: |
        The number of items to fetch. The value should be a positive integer
        and if the limit is set to 0, all items will be fetched.
      in: query
      required: false
      schema:
        type: integer
        example: 5
        default: 5
        minimum: 0
    page:
      name: page
      description: The page number of a paginated list of records.
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1
    itemsPerPage:
      name: itemsPerPage
      description: The number of items per page in a paginated list of records.
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 30
    force:
      name: force
      description: If true, on an archived item, the requested action will be forced and the item will be unarchived.
      in: query
      schema:
        type: boolean
        default: false
    archived:
      name: archived
      description: Indicates if and how archived items should be part of the result.
      in: query
      schema:
        type: string
        enum:
          - excluded
          - included
          - only
        default: excluded

  schemas:
    RegexIdValidation:
      type: string
      description: 'At least one character among those allowed: unaccented alpha-numeric characters, "-", ".", "_", "~", ":", "@", "!", "$", ",".'
      pattern: '^[a-zA-Z0-9-._~:@!$,]+$'

    RegexPrefixedIdValidation:
      type: string
      description: An id beginning with a prefix and an underscore.
      pattern: '^[A-Z]{3,6}_[a-zA-Z0-9-._~:@!$,]+$'

    RegexIsEmpty:
      type: string
      description: Empty string.
      pattern: '^$'

    RegexIdValidationOrEmpty:
      oneOf:
        - $ref: '#/components/schemas/RegexIdValidation'
        - $ref: '#/components/schemas/RegexIsEmpty'

    RegexNotEmpty:
      type: string
      description: Not empty string.
      pattern: '.+'

    RegexPrefixValidation:
      type: string
      description: Between 3 and 6 latin capital letters.
      pattern: '^[A-Z]{3,6}$'

    Email:
      type: string
      description: A valid email address.
      format: email
      example: martin.dupont@kardinal.ai

    EnvelopedString:
      type: object
      properties:
        item:
          type: string

    ObfuscatedEmail:
      type: string
      description: An obfuscated representation of the email used for MFA.
      nullable: true
      example: 'em***********.com'

    AdditionalOperationDuration:
      type: object
      description: Additional operation duration by stop tag and resource tag.
      properties:
        resourceTag:
          type: string
          description: Resource tag.
          example: trailer
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        stopTag:
          type: string
          description: Stop tag.
          example: heavy
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        additionalOperationDuration:
          $ref: '#/components/schemas/Duration'
      required:
        - resourceTag
        - stopTag
        - additionalOperationDuration

    ForbiddenAssignment:
      type: object
      description: Forbidden assignment by stop tag and resource tag.
      properties:
        resourceTag:
          type: string
          description: Resource tag.
          example: trailer
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        stopTag:
          type: string
          description: Stop tag.
          example: heavy
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
      required:
        - resourceTag
        - stopTag

    StopTagPair:
      type: array
      description: A pair of incompatible stop tags.
      items:
        description: Stop tag.
        allOf:
          - $ref: '#/components/schemas/RegexIdValidation'
      minItems: 2
      maxItems: 2
      uniqueItems: true
      example: ["goat", "cabbage"]

    IncompatibleStopTags:
      type: array
      description: Incompatibilities between stop tags (all elements must be different regardless of order).
      uniqueItems: true
      deprecated: true
      items:
        $ref: '#/components/schemas/StopTagPair'
      example: [ ["goat", "cabbage"], ["wolf", "goat"] ]

    ClientPrefix:
      description: The client unique prefix.
      example: LND
      allOf:
        - $ref: '#/components/schemas/RegexPrefixValidation'
    ClientId:
      description: The client id.
      example: LND_FR
      allOf:
        - $ref: '#/components/schemas/RegexPrefixedIdValidation'
    CountryId:
      description: The country id.
      readOnly: true
      example: LND_France
      allOf:
        - $ref: '#/components/schemas/RegexPrefixedIdValidation'
    RegionId:
      description: The region id.
      readOnly: true
      example: LND_Ile-de-France
      allOf:
        - $ref: '#/components/schemas/RegexPrefixedIdValidation'
    AgencyId:
      description: The agency id.
      readOnly: true
      example: LND_Agency-42
      allOf:
        - $ref: '#/components/schemas/RegexPrefixedIdValidation'
    PlanId:
      description: The plan id.
      readOnly: true
      example: plan-AB
      allOf:
        - $ref: '#/components/schemas/RegexIdValidation'
    PlanVersion:
      type: integer
      description: The plan version.
      readOnly: true
      minimum: 1
      example: 42

    PublicKeyJWK:
      type: object
      description: A public key in the JSON Web Key format.
      externalDocs:
        url: https://tools.ietf.org/html/rfc7517
      example:
        alg: "ES384"
        crv: "P-384"
        kid: "ES384-key"
        kty: "EC"
        use: "sig"
        x: "TOl-t2xT1p21AXF-cvd35uKRDOeXejEJ3KTMc-vVD-wEs4TSVGYt2OlICe7dTRtb"
        y: "tUGr_xN9xZsolH3DeFVWXjd0IJ1ZNzC-hippE8XApU7phY_KVKEbrrW8fg72uJiP"

    PublicKeyPEM:
      type: string
      description: A public key in the Privacy-Enhanced Mail format.
      externalDocs:
        url: https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail
      example: |
        -----BEGIN PUBLIC KEY-----
        MHYwEAYHKoZIzj0CAQYFK4EEACIDYgAETOl+t2xT1p21AXF+cvd35uKRDOeXejEJ
        3KTMc+vVD+wEs4TSVGYt2OlICe7dTRtbtUGr/xN9xZsolH3DeFVWXjd0IJ1ZNzC+
        hippE8XApU7phY/KVKEbrrW8fg72uJiP
        -----END PUBLIC KEY-----

    Password:
      type: string
      format: password
      description: |
        A user password must contain at least:
        - 1 number,
        - 1 uppercase letter,
        - 1 lowercase letter,
        - 1 special character amongst the following:
          !"#$%&'()*+,-./:;<=>?@[]^_`{|}~
        - 12 characters.
        And it must not exceed 72 bytes.
      allOf:
        - type: string
          pattern: .*[0-9]{1}
        - type: string
          pattern: .*[A-Z]{1}
        - type: string
          pattern: .*[a-z]{1}
        - type: string
          pattern: .*[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]{1}
        - type: string
          pattern: ^.{12,72}$

    Login:
      type: object
      description: The payload to use for login.
      properties:
        username:
          $ref: '#/components/schemas/Username'
        password:
          description: The user's password.
          allOf:
            - $ref: '#/components/schemas/Password'
      required:
        - username
        - password

    AzureSSOLogin:
      type: object
      description: The payload to use for login through Azure SSO.
      properties:
        accessToken:
          type: string
          example: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imk2bEdrM0ZaenhSY1ViMkMzbkVRN3N5SEpsWSJ9.eyJhdWQiOiI2ZTc0MTcyYi1iZTU2LTQ4NDMtOWZmNC1lNjZhMzliYjEyZTMiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vNzJmOTg4YmYtODZmMS00MWFmLTkxYWItMmQ3Y2QwMTFkYjQ3L3YyLjAiLCJpYXQiOjE1MzcyMzEwNDgsIm5iZiI6MTUzNzIzMTA0OCwiZXhwIjoxNTM3MjM0OTQ4LCJhaW8iOiJBWFFBaS84SUFBQUF0QWFaTG8zQ2hNaWY2S09udHRSQjdlQnE0L0RjY1F6amNKR3hQWXkvQzNqRGFOR3hYZDZ3TklJVkdSZ2hOUm53SjFsT2NBbk5aY2p2a295ckZ4Q3R0djMzMTQwUmlvT0ZKNGJDQ0dWdW9DYWcxdU9UVDIyMjIyZ0h3TFBZUS91Zjc5UVgrMEtJaWpkcm1wNjlSY3R6bVE9PSIsImF6cCI6IjZlNzQxNzJiLWJlNTYtNDg0My05ZmY0LWU2NmEzOWJiMTJlMyIsImF6cGFjciI6IjAiLCJuYW1lIjoiQWJlIExpbmNvbG4iLCJvaWQiOiI2OTAyMjJiZS1mZjFhLTRkNTYtYWJkMS03ZTRmN2QzOGU0NzQiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJhYmVsaUBtaWNyb3NvZnQuY29tIiwicmgiOiJJIiwic2NwIjoiYWNjZXNzX2FzX3VzZXIiLCJzdWIiOiJIS1pwZmFIeVdhZGVPb3VZbGl0anJJLUtmZlRtMjIyWDVyclYzeERxZktRIiwidGlkIjoiNzJmOTg4YmYtODZmMS00MWFmLTkxYWItMmQ3Y2QwMTFkYjQ3IiwidXRpIjoiZnFpQnFYTFBqMGVRYTgyUy1JWUZBQSIsInZlciI6IjIuMCJ9.pj4N-w_3Us9DrBLfpCt
        idToken:
          type: string
          example: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IjFMVE16YWtpaGlSbGFfOHoyQkVKVlhlV01xbyJ9.eyJ2ZXIiOiIyLjAiLCJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vOTEyMjA0MGQtNmM2Ny00YzViLWIxMTItMzZhMzA0YjY2ZGFkL3YyLjAiLCJzdWIiOiJBQUFBQUFBQUFBQUFBQUFBQUFBQUFJa3pxRlZyU2FTYUZIeTc4MmJidGFRIiwiYXVkIjoiNmNiMDQwMTgtYTNmNS00NmE3LWI5OTUtOTQwYzc4ZjVhZWYzIiwiZXhwIjoxNTM2MzYxNDExLCJpYXQiOjE1MzYyNzQ3MTEsIm5iZiI6MTUzNjI3NDcxMSwibmFtZSI6IkFiZSBMaW5jb2xuIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiQWJlTGlAbWljcm9zb2Z0LmNvbSIsIm9pZCI6IjAwMDAwMDAwLTAwMDAtMDAwMC02NmYzLTMzMzJlY2E3ZWE4MSIsInRpZCI6IjkxMjIwNDBkLTZjNjctNGM1Yi1iMTEyLTM2YTMwNGI2NmRhZCIsIm5vbmNlIjoiMTIzNTIzIiwiYWlvIjoiRGYyVVZYTDFpeCFsTUNXTVNPSkJjRmF0emNHZnZGR2hqS3Y4cTVnMHg3MzJkUjVNQjVCaXN2R1FPN1lXQnlqZDhpUURMcSFlR2JJRGFreXA1bW5PcmNkcUhlWVNubHRlcFFtUnA2QUlaOGpZIn0.1AFWW-Ck5nROwSlltm7GzZvDwUkqvhSQpm55TQsmVo9Y59cLhRXpvB8n-55HCr9Z6G_31_UbeUkoz612I2j_Sm9FFShSDDjoaLQr54CreGIJvjtmS3EkK9a7SJBbcpL1MpUtlfygow39tFjY7EVNW9plWUvRrTgVk7lYLprvfzw-CIqw3gHC-T7IK_m_xkr08INERBtaecwhTeN4chPC4W3jdmw_lIxzC48YoQ0dB1L9-ImX98Egypfrlbm0IBL5spFzL6JDZIRRJOu8vecJvj1mq-IUhGt0MacxX8jdxYLP-KUu2d9MbNKpCKJuZ7p8gwTL5B7NlUdh_dmSviPWrw
      required:
        - accessToken
        - idToken

    GoogleSSOLogin:
      type: object
      description: The payload to use for login through Google SSO.
      properties:
        accessToken:
          type: string
          example: ya28.a0AfB_byCbEgO5rOeu73KBdAv0ZeiEFz7xzgxtdCzailCy9ew6BCgKUaiheRxDJ1Do8HbiXVxMcm5jyo_5fV_yAtYKhSLKayMvGH0n00E-NtOgtH5myIhpc7heq5zZ788XSzoHxJ9aSWR_y1Vr7-zWiRWe_YANqnmEo6FaaCgYKAckERASSFQHGX2MilpI4NsOBgWYkOo1zKgJPmg0171
      required:
        - accessToken

    GDPRApproval:
      type: object
      description: The payload to use for a GDPR policy approval.
      properties:
        version:
          type: string
      required:
        - version

    OTPToken:
      type: string
      description: A JSON Web Token with scope 'otp', to be used with an OTP (One-Time Password) value, valid for 10 minutes.
      example: eyJhbGciOiJFZERTQSJ9.eyJhdWQiOlsiYXBpIiwiZnJvbnQiXSwiZXhwIjoxNzI3OTU3NjM2LCJpYXQiOjE3Mjc5NTcwMzYsImlzcyI6ImthcmRpbmFsLmp3dCIsIm5iZiI6MTcyNzk1NzAzNSwib3RwVHlwZSI6ImVtYWlsIiwic2NvcGUiOiJvdHAiLCJzdWIiOiJzb21lQG9uZS5jb20ifQ.Urhz2i-b_j5kb-Sa_GwyYrZusDtPpCmzUxLqo3EHi_bK0Gpx3cfov4rouE9XCH-HcaT4l16hot2Nkt31QwOJAQ
    GDPRToken:
      type: string
      description: A JSON Web Token with scope 'gdpr', to be used to approve a GDPR policy, valid for 1 hour.
      example: eyJhbGciOiJFZERTQSJ9.eyJhdWQiOlsiYXBpIiwiZnJvbnQiXSwiZXhwIjoxNzI4OTgzMDUwLCJpYXQiOjE3Mjg5Nzk0NTAsImlzcyI6ImthcmRpbmFsLmp3dCIsIm5iZiI6MTcyODk3OTQ0OSwic2NvcGUiOiJnZHByIiwic3ViIjoibWFydGluLmR1cG9udEBrYXJkaW5hbC5haSJ9.0Bfl_ckUrPGmocrXWoMDbUN4Xl0ZnHrEJV9JKzG1d8_Aw69EXZZie-qI4yFiQR1tnVp56RUz6UIAMIvrcMp9DA
    MFAToken:
      type: string
      description: A JSON Web Token with scope 'mfa', to be used to setup MFA authentication, valid for 1 hour.
      example: eyJhbGciOiJFZERTQSJ9.eyJhdWQiOlsiYXBpIiwiZnJvbnQiXSwiZXhwIjoxNzMyNjQ0MzY0LCJpYXQiOjE3MzI2NDA3NjQsImlzcyI6ImthcmRpbmFsLmp3dCIsIm5iZiI6MTczMjY0MDc2Mywic2NvcGUiOiJtZmEiLCJzdWIiOiJtYXJ0aW4uZHVwb250QGthcmRpbmFsLmFpIn0.XdFyT6ov-Y3GNIgudfm68hIAfIoj4SyKLule3HAnfceDXChEfHllninFiPAEwEzLCRDWOscTTu3J2Vkb3VysDg
    AccessToken:
      type: string
      description: A JSON Web Token with scope 'access', to be used to access protected data, valid for 1 hour.
      example: eyJhbGciOiJFZERTQSJ9.eyJhdWQiOlsia2FyZGluYWwubWljcm9fc2VydmljZSJdLCJleHAiOjE2MTA3MzI1NzMsImlhdCI6MTYxMDczMjU3MiwiaXNzIjoia2FyZGluYWwuand0IiwibmJmIjoxNjEwNzMyNTcxLCJzY29wZSI6ImFjY2VzcyIsInN1YiI6InRvdG8iLCJ0cnVjIjoiYWJjZDQyIn0.8M-6hV6zJf-OJBs_biiRa2Kn-JIAvgCUdc3b4Pcf3mVLlGHSSmAyD1YTy3kBmHxzoWjI8ra3laDUlnd2oLXvDw
    RefreshToken:
      type: string
      description: A JSON Web Token with scope 'refresh', to be used to refresh the access token, valid for 30 days.
      example: eyJhbGciOiJFZERTQSJ9.eyJhdWQiOlsia2FyZGluYWwubWljcm9fc2VydmljZSJdLCJleHAiOjE2MTA3MzI1NzMsImlhdCI6MTYxMDczMjU3MiwiaXNzIjoia2FyZGluYWwuand0IiwibmJmIjoxNjEwNzMyNTcxLCJzY29wZSI6InJlZnJlc2giLCJzdWIiOiJ0b3RvIn0.6QkM9IV3mHPG2jAqfCj5jm44ha-cPA85JEkDQR46kZ9Y8cuzN8nqCxhN67j2MYFJYSEEIYnwYimR3fZUIr-9Bg
    PasswordToken:
      type: string
      description: A JSON Web Token with scope 'password', to be used to set or reset one's password, valid for 24 hours (for creation) or 10 minutes (for reset).
      example: eyJhbGciOiJFZERTQSJ9.eyJhdWQiOlsia2FyZGluYWwubWljcm9fc2VydmljZSJdLCJleHAiOjE2ODYzMDM4MDYsImlhdCI6MTY4NjMwMzIwNiwiaXNzIjoia2FyZGluYWwuand0IiwibmJmIjoxNjg2MzAzMjA1LCJzY29wZSI6InBhc3N3b3JkIiwic3ViIjoibWFydGluLmR1cG9udEBrYXJkaW5hbC5haSJ9.U4ZSlGVVTx10LLVrk8Lta1GwZITMr49LICPhJ5zByrXqi1d0wFhwpUokz4eQSzZxWNsyA70xGmRdZjhFclaTBQ

    EnvelopedLoginGDPROutput:
      type: object
      description: An object containing a 'gdpr' JSON Web Token, returned by a successful login of a user which needs to approve a GDPR policy.
      properties:
        item:
          type: object
          properties:
            gdprToken:
              $ref: '#/components/schemas/GDPRToken'
        access_token:
          # For backward compatibility
          # NOTE: we used the property name 'access_token' instead of 'gdpr_token'
          allOf:
            - deprecated: true
            - $ref: '#/components/schemas/GDPRToken'

    EnvelopedLoginMFAOutput:
      type: object
      description: An object containing a 'mfa' JSON Web Token, returned by a successful login of a user which needs to setup MFA authentication.
      properties:
        item:
          type: object
          properties:
            mfaToken:
              $ref: '#/components/schemas/MFAToken'
        access_token:
          # For backward compatibility
          # NOTE: we used the property name 'access_token' instead of 'mfa_token'
          allOf:
            - deprecated: true
            - $ref: '#/components/schemas/MFAToken'

    EnvelopedLoginAccessOutput:
      type: object
      description: An object containing the access and refresh JSON Web Tokens and the user description, returned by a successful login.
      properties:
        item:
          type: object
          properties:
            accessToken:
              $ref: '#/components/schemas/AccessToken'
            refreshToken:
              $ref: '#/components/schemas/RefreshToken'
            user:
              $ref: '#/components/schemas/User'
        access_token:
          # For backward compatibility
          allOf:
            - deprecated: true
            - $ref: '#/components/schemas/AccessToken'
        refresh_token:
          # For backward compatibility
          allOf:
            - deprecated: true
            - $ref: '#/components/schemas/RefreshToken'
        user:
          # For backward compatibility
          allOf:
            - deprecated: true
            - $ref: '#/components/schemas/User'

    UsernameRequest:
      type: object
      description: An object containing a username.
      properties:
        username:
          $ref: '#/components/schemas/Username'

    PasswordRequest:
      type: object
      description: An object containing a new password and a confirmation of the new password.
      properties:
        password:
          description: A new password.
          allOf:
            - $ref: '#/components/schemas/Password'
        confirmPassword:
          description: The confirmation of the new password.
          allOf:
            - $ref: '#/components/schemas/Password'

    TokenRequest:
      type: object
      description: An object containing a password token.
      properties:
        token:
          $ref: '#/components/schemas/PasswordToken'

    EnvelopedLoginRefreshOutput:
      type: object
      description: An object containing the new access token.
      properties:
        item:
          type: object
          properties:
            accessToken:
              $ref: '#/components/schemas/AccessToken'
        access_token:
          # For backward compatibility
          allOf:
            - deprecated: true
            - $ref: '#/components/schemas/AccessToken'

    AuthenticationMethod:
      type: object
      description: An authentication method to be used for login.
      properties:
        provider:
          type: string
          description: The name of the authentication provider.
        properties:
          type: object
          description: Additional properties needed by the authentication method.
        authUrl:
          type: string
          description: The absolute path of the login endpoint to use.
      required:
        - provider
        - authUrl

    AuthenticationMethods:
      type: array
      items:
        $ref: '#/components/schemas/AuthenticationMethod'
      example:
        - provider: azure
          properties:
            tenantId: 460498e4-4a40-48c1-884a-93deaddbc1a3
            clientId: 030b609a-e9cc-49bf-bedc-fbf846a4d8b6,
            scopes:
              - api://030b609a-e9cc-49bf-bedc-fbf846a4d8b6/UsersRead
          authUrl: /api/v2/login/sso/azure
        - provider: kardinal
          authUrl: /api/v2/login

    EnvelopedAuthenticationMethods:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AuthenticationMethods'

    CountryIds:
      type: array
      description: A list of country identifiers.
      items:
        $ref: '#/components/schemas/CountryId'
      example: [ "LND_France", "LND_Belgique" ]

    RegionIds:
      type: array
      description: A list of region identifiers.
      items:
        $ref: '#/components/schemas/RegionId'
      example: [ "LND_Ile-de-France", "LND_Grand-Ouest" ]

    AgencyIds:
      type: array
      description: A list of agency identifiers.
      items:
        $ref: '#/components/schemas/AgencyId'
      example: [ "LND_Agency-01", "LND_Agency-42" ]

    Role:
      type: string
      description: The user's role.
      enum:
        - analyst
        - expert
        - super
      default: analyst
      example: expert

    Level:
      type: string
      description: The user's level.
      enum:
        - super
        - platformAdmin
        - admin
        - owner
        - country
        - region
        - agency
      default: agency
      example: country

    Username:
      type: string
      description: The username is used for login, it is unique for each user, it can be either an email (for clients) or a regular username (for Kardinal's internal users).
      example: martin.dupont@kardinal.ai
      oneOf:
        - $ref: '#/components/schemas/RegexNotEmpty'
        - $ref: '#/components/schemas/Email'

    UserStatus:
      type: string
      description: The user's status.
      enum:
        - enabled
        - disabled
        - pending
      example: pending
      readOnly: true

    UserType:
      type: string
      description: The user type.
      enum:
        - standard
        - api
        - simpleApi
      default: standard
      example: standard

    User:
      type: object
      description: A user is a person who can use Platform's services.
      properties:
        id:
          type: string
          format: uuid
          description: Kardinal's unique identifier.
          readOnly: true
          example: 483fad31-415d-4d9e-8edd-c8f936e71520
        username:
          $ref: '#/components/schemas/Username'
        type:
          $ref: '#/components/schemas/UserType'
        password:
          writeOnly: true
          description: The user's password.
          allOf:
            - $ref: '#/components/schemas/Password'
        role:
          $ref: '#/components/schemas/Role'
        firstname:
          type: string
          description: The user's first name.
          example: Martin
          nullable: true
        lastname:
          type: string
          description: The user's last name.
          example: DUPONT
          nullable: true
        level:
          $ref: '#/components/schemas/Level'
        countries:
          description: The countries whose data the user is allowed to see.
          allOf:
            - $ref: '#/components/schemas/CountryIds'
        regions:
          description: The regions whose data the user is allowed to see.
          allOf:
            - $ref: '#/components/schemas/RegionIds'
        agencies:
          description: The agencies whose data the user is allowed to see.
          allOf:
            - $ref: '#/components/schemas/AgencyIds'
        active:
          description: Represents whether the user is enabled or disabled internally.
          example: true
          type: boolean
        status:
          $ref: '#/components/schemas/UserStatus'
        lastLoginAt:
          description: Represents the last login date of the user.
          nullable: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        createdAt:
          description: The user's creation date.
          nullable: false
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        updatedAt:
          description: The user's last update date.
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        clientId:
          description: |
            The id of the client whom the user is linked to.
            It can be empty for a user which level is greater than 'owner'.

            When creating a new user, this id can be left empty if:
            - the caller has the level 'region' or 'country' or 'owner': in this case, the clientId of the new user is inherited from the clientId of the caller,
            - the new user has a level greater than 'owner'.
          allOf:
            - $ref: '#/components/schemas/ClientId'
        gdprInfo:
          type: object
          properties:
            version:
              type: string
            approvedAt:
              $ref: '#/components/schemas/DateTime'
        managedClientsIds:
          type: array
          description: "For an 'admin' user only: the ids of the clients which are managed by this user."
          items:
            $ref: '#/components/schemas/ClientId'
      required:
        - username

    EnvelopedUser:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/User'

    EnvelopedUsers:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/User'

    UserAPIInput:
      type: object
      description: |
        An input which allows to create a user with simpleApi or complexApi usage, the associated client, and the client hierarchy.
      properties:
        email:
          $ref: '#/components/schemas/Email'
        company:
          type: string
          description: The client name to use for this simpleApi/complexApi user.
        type:
          type: string
          description: |
            The input type describes the desired API usage:
            - simpleApi: will create a user with type "simpleApi" and access to a simplified ARO API,
            - complexApi: will create a user with type "standard" and access to the full ARO API.
          enum:
            - simpleApi
            - complexApi
          default: simpleApi
        firstname:
          type: string
          description: The user's first name
        lastname:
          type: string
          description: The user's last name
      required:
        - email
        - company

    UserAPIOutput:
      type: object
      description: An object containing a newly created simpleApi/complexApi user, with his JWT access tokens.
      properties:
        user:
          $ref: '#/components/schemas/User'
        accessTokens:
          type: object
          properties:
            additionalProperties:
              $ref: '#/components/schemas/AccessToken'
          example:
            "test": "eyJhbGciOiJFZERTQSJ9.eyJhZ2...7EmUDA"
            "prod": "eyJhbGciOiJFZERTQSJ9.eyJhZ2...4vEdCw"

    EnvelopedUserAPIOutput:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/UserAPIOutput'

    Agency:
      type: object
      description: A client's agency.
      properties:
        id:
          type: string
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/AgencyId'
        createdAt:
          description: The agency's creation date.
          nullable: false
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        updatedAt:
          description: The agency's last update date.
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        name:
          type: string
          description: The agency name.
          example: "Agence LND Paris 9"
      required:
        - id

    AgencyForCreation:
      type: object
      description: An agency payload for the creation of an agency.
      properties:
        id:
          nullable: false
          readOnly: false
          example: LND_Agency-42
          allOf:
            - $ref: '#/components/schemas/AgencyId'
        name:
          type: string
          description: The agency name.
          example: "Agence 42"
      required:
        - id

    AgencyForUpdate:
      type: object
      description: An agency payload for the update of an agency.
      properties:
        name:
          nullable: true
          type: string
          description: The agency name.
          example: "Agence 42"

    EnvelopedAgency:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/Agency'

    Agencies:
      type: array
      items:
        $ref: '#/components/schemas/Agency'

    EnvelopedAgencies:
      type: object
      properties:
        items:
          $ref: '#/components/schemas/Agencies'

    PlainRegion:
      type: object
      description: A client's region, without agencies.
      properties:
        id:
          type: string
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/RegionId'
        createdAt:
          description: The region's creation date.
          nullable: false
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        updatedAt:
          description: The region's last update date.
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        name:
          type: string
          description: The region name.
          example: "Ile-de-France"
      required:
        - id

    EnvelopedPlainRegion:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/PlainRegion'

    Region:
      type: object
      description: A client's region, containing one or more agency(ies).
      allOf:
        - $ref: '#/components/schemas/PlainRegion'
        - properties:
            agencies:
              $ref: '#/components/schemas/Agencies'

    RegionForCreation:
      type: object
      description: A region payload for the creation of a region.
      properties:
        id:
          nullable: false
          readOnly: false
          example: LND_Ile-de-France
          allOf:
            - $ref: '#/components/schemas/RegionId'
        name:
          type: string
          description: The region name.
          example: "Rgion Ile de France"
      required:
        - id

    RegionForUpdate:
      type: object
      description: A region payload for the update of a region.
      properties:
        name:
          nullable: true
          type: string
          description: The region name.
          example: "Grand Ouest"

    Regions:
      type: array
      items:
        $ref: '#/components/schemas/Region'

    EnvelopedRegions:
      type: object
      properties:
        items:
          $ref: '#/components/schemas/Regions'

    PlainCountry:
      type: object
      description: A client's country, without regions.
      properties:
        id:
          type: string
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/CountryId'
        createdAt:
          description: The country's creation date.
          nullable: false
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        updatedAt:
          description: The country's last update date.
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        name:
          type: string
          description: The country name.
          example: "France"
      required:
        - id

    EnvelopedPlainCountry:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/PlainCountry'

    Country:
      type: object
      description: A client's country, containing one or more region(s).
      allOf:
        - $ref: '#/components/schemas/PlainCountry'
        - properties:
            regions:
              $ref: '#/components/schemas/Regions'

    CountryForCreation:
      type: object
      description: A country payload for the creation of a country.
      properties:
        id:
          nullable: false
          readOnly: false
          example: LND_France
          allOf:
            - $ref: '#/components/schemas/CountryId'
        name:
          type: string
          description: The country name.
          example: "Pays France"
      required:
        - id

    CountryForUpdate:
      type: object
      description: A country payload for the update of a country.
      properties:
        name:
          nullable: true
          type: string
          description: The country name.
          example: "France"

    Countries:
      type: array
      items:
        $ref: '#/components/schemas/Country'

    EnvelopedCountries:
      type: object
      properties:
        items:
          $ref: '#/components/schemas/Countries'

    ProductConf:
      type: object
      description: A product configuration.
      properties:
        allowed:
          type: boolean
        customProperties:
          type: object
          additionalProperties: true
          example:
            foo: 42
            bar: "alpha"
            toto: [2, 4, 6, 8]
            titi: {"one": 1, "two": "PT33M32S", "three": false, "four": ["bla"], "five": {"cat": 4}}
        archiving:
          type: object
          description: The delay before data is archived, for each concerned module.
          additionalProperties:
            $ref: "#/components/schemas/Duration"
        retention:
          type: object
          description: The delay before data is cleaned up, for each concerned module.
          additionalProperties:
            $ref: "#/components/schemas/Duration"

    APIConfSpecific:
      type: object
      description: A product complementary configuration for API.
      default:
        allowed: false

    AROConfSpecific:
      type: object
      description: A product complementary configuration for ARO.
      default:
        allowed: false
        archiving:
          phoebe: "P14D"
          paola: "P3M"
        retention:
          phoebe: "P1Y"
          paola: "P1Y"
          iris: "P1Y"

    TAOConfSpecific:
      type: object
      description: A product complementary configuration for TAO.
      properties:
        requiredProperties:
          $ref: '#/components/schemas/TAOConfRequiredProperties'
        maxSectorizationsInParallel:
          type: number
          format: integer
          minimum: 0
          default: 5
      default:
        allowed: true
        requiredProperties: ~
        maxSectorizationsInParallel: 5
        archiving:
          beatrix: "P1Y"
        retention:
          beatrix: "P1Y"

    PUDOConfSpecific:
      type: object
      description: A product complementary configuration for PUDO.
      default:
        allowed: false
        archiving:
          padme: "P1Y"
        retention:
          padme: "P1Y"

    ClientConf:
      type: object
      description: A client's configuration.
      properties:
        api:
          allOf:
            - $ref: '#/components/schemas/ProductConf'
            - $ref: '#/components/schemas/APIConfSpecific'
        aro:
          allOf:
            - $ref: '#/components/schemas/ProductConf'
            - $ref: '#/components/schemas/AROConfSpecific'
        tao:
          allOf:
            - $ref: '#/components/schemas/ProductConf'
            - $ref: '#/components/schemas/TAOConfSpecific'
        pudo:
          allOf:
            - $ref: '#/components/schemas/ProductConf'
            - $ref: '#/components/schemas/PUDOConfSpecific'
        customProperties:
          type: object
          additionalProperties: true
          example:
            foo: 42
            bar: "alpha"
            toto: [2, 4, 6, 8]
            titi: {"one": 1, "two": "PT33M32S", "three": false, "four": ["bla"], "five": {"cat": 4}}

    EnvelopedClientConf:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/ClientConf'

    TAOConfRequiredProperties:
      type: object
      description: The required properties for TAO.
      properties:
        cells:
          type: array
          items:
            type: string
          example: ["postalCode"]
        samples:
          type: array
          items:
            type: string
          example: ["date","dow","activityLevel"]
        stops:
          type: array
          items:
            type: string
          example: ["address"]

    ClientForCreation:
      type: object
      description: A Kardinal's client payload for creation.
      properties:
        id:
          nullable: false
          readOnly: false
          allOf:
          - $ref: '#/components/schemas/ClientId'
        name:
          type: string
          description: The client name.
          example: "Lanidrak"
        prefix:
          nullable: false
          readOnly: false
          example: LND
          allOf:
          - $ref: '#/components/schemas/ClientPrefix'
        conf:
          nullable: true
          allOf:
          - $ref: '#/components/schemas/ClientConf'
      required:
        - id
        - prefix

    ClientForUpdate:
      type: object
      description: A Kardinal's client payload for update.
      properties:
        name:
          type: string
          description: The client name.
          example: "Lanidrak"
        conf:
          nullable: true
          allOf:
          - $ref: '#/components/schemas/ClientConf'

    Client:
      type: object
      description: A Kardinal's client.
      properties:
        id:
          nullable: false
          readOnly: false
          allOf:
          - $ref: '#/components/schemas/ClientId'
        createdAt:
          description: The client's creation date.
          nullable: false
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        updatedAt:
          description: The client's last update date.
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        name:
          type: string
          description: The client name.
          example: "Lanidrak"
        prefix:
          nullable: false
          readOnly: false
          example: LND
          allOf:
          - $ref: '#/components/schemas/ClientPrefix'
        ownerIds:
          type: array
          description: The identifier(s) of the user(s) who can manage the client.
          items:
            type: string
            example: ee247398-ef7e-4566-96ce-11963f19d940
        countries:
          $ref: '#/components/schemas/Countries'
        conf:
          nullable: true
          allOf:
          - $ref: '#/components/schemas/ClientConf'
      required:
        - id
        - prefix

    Clients:
      type: array
      items:
        $ref: '#/components/schemas/Client'

    EnvelopedClient:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/Client'

    EnvelopedClients:
      type: object
      properties:
        items:
          $ref: '#/components/schemas/Clients'

    PlanLight:
      type: object
      description: A plan without resources, orders, ... for a date and agency.
      properties:
        id:
          $ref: '#/components/schemas/PlanId'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        version:
          $ref: '#/components/schemas/PlanVersion'
        running:
          type: boolean
          description: To know if the plan is running.
          readOnly: true
        status:
          $ref: '#/components/schemas/PlanStatus'
        properties:
          $ref: '#/components/schemas/Properties'

    EnvelopedPlansLight:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PlanLight'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        paging:
          $ref: '#/components/schemas/Paging'

    Plan:
      type: object
      description: A plan for a date and agency, with resource and orders associated.
      properties:
        id:
          $ref: '#/components/schemas/PlanId'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        version:
          $ref: '#/components/schemas/PlanVersion'
        running:
          type: boolean
          description: To know if the plan is running.
          readOnly: true
        status:
          allOf:
            - $ref: '#/components/schemas/PlanStatus'
        state:
          allOf:
            - $ref: '#/components/schemas/PlanState'
        properties:
          allOf:
            - $ref: '#/components/schemas/Properties'
        resources:
          type: array
          items:
            $ref: '#/components/schemas/Resource'
        orders:
          type: array
          items:
            $ref: '#/components/schemas/Order'
        additionalOperationDurations:
          type: array
          description: Additional operation time for a resource and a stop, according to tags (pairs of tags must be unique).
          uniqueItems: true
          items:
            $ref: '#/components/schemas/AdditionalOperationDuration'
        operationDurationPoliciesByResourceTag:
          type: object
          description: Policies to remove the operation durations, by resource tag.
          additionalProperties:
            type: array
            items:
              $ref: '#/components/schemas/OperationDurationPolicy'
        forbiddenAssignments:
          type: array
          uniqueItems: true
          deprecated: true
          items:
            $ref: '#/components/schemas/ForbiddenAssignment'
        incompatibleStopTags:
          allOf:
            - $ref: '#/components/schemas/IncompatibleStopTags'
        additionalConstraints:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/AdditionalConstraintAtLeastOneValidCapacity'
              - $ref: '#/components/schemas/AdditionalConstraintForbiddenAssignment'
              - $ref: '#/components/schemas/AdditionalConstraintIncompatibleStopTags'
              - $ref: '#/components/schemas/AdditionalConstraintAtLeastOneConstraint'
              - $ref: '#/components/schemas/AdditionalConstraintCapacities'
              - $ref: '#/components/schemas/AdditionalConstraintMaxStopTagGroups'
              - $ref: '#/components/schemas/AdditionalConstraintRemovalStrategy'
        globalConstraints:
          type: array
          description: List of global constraints to be satisfied by the returned solution.
          items:
            oneOf:
              - $ref: '#/components/schemas/GlobalConstraintMaxCumulatedCost'
        accessDurationsByStopTag:
          type: object
          description: Access durations is an additional duration before the beginning of a group of stops with the same stop tag.
          additionalProperties:
            allOf:
              - $ref: '#/components/schemas/Duration'
          example: { "access:parking33": "PT5M" }
        overlappingCapacitiesByStopTag:
          type: object
          description: This field allows users to define a limit in the number of resources that are simultaneously present at stops sharing the same stop tag.
          additionalProperties:
            type: integer
          example: { "capa:bat22": 3 }
        setupDurations:
          type: array
          items:
            $ref: '#/components/schemas/SetupDuration'
        objectives:
          allOf:
            - $ref: '#/components/schemas/PlanObjectives'
        maxOptimizationDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
        tz:
          $ref: '#/components/schemas/TimeZone'
        createdAt:
          description: The plan's creation datetime.
          nullable: false
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        updatedAt:
          description: The plan's last update datetime.
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        archivedAt:
          description: "The plan's archiving datetime: if not null, the plan is archived."
          nullable: true
          readOnly: true
          example: null
          allOf:
            - $ref: '#/components/schemas/DateTime'
        lateDeparture:
          description: True if lateDeparture is requested for Resources, false otherwise.
          type: boolean
          default: false
        sharedCapacities:
          description: True if sharedCapacities is requested for Resources, false otherwise. It enables resources to share capacities between stops of different orders.
          type: boolean
          default: false
      required:
        - id
        - agencyId
        - resources

    EnvelopedPlan:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/Plan'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    PlanState:
      type: string
      readOnly: true
      description: |
        The corresponding plan's state.
          - waiting: The plan was received and is awaiting processing.
          - processing: The plan is being processed.
          - preOptimizing: The plan is being optimized while awaiting traffic or other information.
          - optimizing: The plan is being optimized with all required information.
          - optimized: This state can be triggered by one of the following events:
              No better solution can be produced or the optimization period has reached its limit.
              Note that 'optimized' is not final and can be triggered more than once.
          - stopped: The plan's awaiting optimizations were canceled.
          - deleted: The plan was deleted and awaiting optimizations were canceled.
          - interrupted: The plan was either updated, stopped or deleted during its optimization.
      enum:
        - waiting
        - processing
        - preOptimizing
        - optimizing
        - optimized
        - stopped
        - deleted
        - interrupted

    TimedPlanState:
      type: object
      readOnly: true
      properties:
        planVersion:
          description: The corresponding plan's version.
          type: number
          example: 2
        timestamp:
          $ref: '#/components/schemas/DateTime'
        state:
          $ref: '#/components/schemas/PlanState'

    EnvelopedTimedPlanState:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/TimedPlanState'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'

    EnvelopedTimedPlanStates:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TimedPlanState'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'

    PlanStatus:
      type: object
      readOnly: true
      properties:
        planVersionInSolution:
          description: The plan version taken into account in the current solution.
          allOf:
            - $ref: '#/components/schemas/PlanVersion'
        waitingRoom:
          description: If the maximum number of simultaneous running plans has already been reached, the plan waits in the waiting room for one of the running plans to finish.
          allOf:
            - $ref: '#/components/schemas/PlanStatusVersion'
        waitingTraffic:
          description: The plan is waiting for its traffic coefficients to be computed.
          allOf:
            - $ref: '#/components/schemas/PlanStatusVersion'
        creation:
          description: The plan is being created in order to be optimized.
          allOf:
            - $ref: '#/components/schemas/PlanStatusVersion'
        optimization:
          description: The plan is being optimized.
          allOf:
            - $ref: '#/components/schemas/PlanStatusVersion'

    EnvelopedPlanStatus:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/PlanStatus'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    PlanMode:
      type: string
      enum:
        - standard
        - manual
      default: standard
      example: standard

    EnvelopedPlanMode:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/PlanMode'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    EnvelopedBoolResponse:
      type: object
      properties:
        item:
          type: boolean
          example: true
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    PlanStatusVersion:
      type: object
      properties:
        waitingVersion:
          description: The version currently waiting.
          allOf:
            - $ref: '#/components/schemas/PlanVersion'
        runningVersion:
          description: The version currently running.
          allOf:
            - $ref: '#/components/schemas/PlanVersion'

    Properties:
      type: object
      additionalProperties:
        type: string

    Resource:
      type: object
      properties:
        id:
          description: Resource ids must be unique within a plan.
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        properties:
          $ref: '#/components/schemas/Properties'
        state:
          allOf:
            - $ref: '#/components/schemas/State'
        cost:
          allOf:
            - $ref: '#/components/schemas/Cost'
        priority:
          description: 0 by default, can be negative.
          type: integer
          default: 0
        skills:
          type: array
          uniqueItems: true
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: [ "forklift", "truck" ]
        preferredStopTags:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          uniqueItems: true
          example: [ "access:parking33", "capa:bat22", "setup:france" ]
        tags:
          type: array
          uniqueItems: true
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: [ "trailer" ]
        vehicleProfile:
          oneOf:
            - $ref: '#/components/schemas/VehicleProfileFly'
            - $ref: '#/components/schemas/VehicleProfilePedestrian'
            - $ref: '#/components/schemas/VehicleProfileBicycle'
            - $ref: '#/components/schemas/VehicleProfileScooter'
            - $ref: '#/components/schemas/VehicleProfileMotorbike'
            - $ref: '#/components/schemas/VehicleProfileCar'
            - $ref: '#/components/schemas/VehicleProfileTruck'
        capacities:
          allOf:
            - $ref: '#/components/schemas/Capacities'
        departure:
          allOf:
            - $ref: '#/components/schemas/Position'
        arrival:
          oneOf:
            - $ref: '#/components/schemas/Position'
            - $ref: '#/components/schemas/AtFirstPositionArrival'
        workingTimeWindow:
          allOf:
            - $ref: '#/components/schemas/TimeWindow'
        maxWorkingDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
        maxDistanceInKm:
          type: number
        breaks:
          type: array
          items:
            $ref: '#/components/schemas/Break'
        operationDurationPolicies:
          type: array
          items:
            $ref: '#/components/schemas/OperationDurationPolicy'
        travelTimeCoefficient:
          type: number
          format: float
          example: 1.05
      required:
        - id
        - vehicleProfile
        - workingTimeWindow

    EnvelopedResource:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/Resource'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    ResourceMode:
      type: string
      enum:
        - free
        - fixed
      default: free

    Stop:
      oneOf:
        - $ref: '#/components/schemas/SingleStop'
        - $ref: '#/components/schemas/AlternativesStop'

    StopKind:
      type: string
      enum:
        - pickup
        - delivery
        - acknowledgement
      default: delivery

    SingleStop:
      type: object
      properties:
        type:
            type: string
            enum:
              - single
            default: single
        id:
          description: Single stop ids must be unique within a plan.
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        properties:
          $ref: '#/components/schemas/Properties'
        tags:
          description: prefix:suffix best practice, not forced.
          type: array
          uniqueItems: true
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: [ "access:parking33", "capa:bat22", "setup:france" ]
        position:
          allOf:
            - $ref: '#/components/schemas/Position'
        kind:
          $ref: '#/components/schemas/StopKind'
        operationDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
        capacities:
          allOf:
            - $ref: '#/components/schemas/Capacities'
        authorizedTimeWindows:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/TaggedTimeWindow'
        preferredTimeWindows:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/TaggedTimeWindow'
      required:
        - id
        - position

    AlternativesStop:
      type: object
      description: A stop composed of different alternative single stops.
      properties:
        type:
          type: string
          enum:
            - alternatives
        alternatives:
          type: array
          items:
            allOf:
              - $ref: '#/components/schemas/SingleStop'
      required:
        - type
        - alternatives

    Order:
      type: object
      properties:
        id:
          description: Order ids must be unique within a plan.
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        properties:
          $ref: '#/components/schemas/Properties'
        priority:
          description: 0 by default, can be negative.
          type: integer
          default: 0
        optional:
          type: boolean
        requiredSkills:
          type: array
          uniqueItems: true
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: [ "forklift", "truck" ]
        stops:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/Stop'
        successiveStops:
          type: boolean
        maxStopSpan:
          allOf:
            - $ref: '#/components/schemas/Duration'
      required:
        - id
        - stops

    EnvelopedOrder:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/Order'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    SetupDuration:
      type: object
      properties:
        fromStopTag:
          type: string
          example: "setup:france"
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        toStopTag:
          type: string
          example: "setup:belgium"
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        setupDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
      required:
        - fromStopTag
        - toStopTag
        - setupDuration

    GlobalConstraintMaxCumulatedCost:
      type: object
      description: Provide an upper bound on the cost of specified resources.
      properties:
        type:
          type: string
          enum:
            - maxCumulatedCost
        name:
          type: string
        maximum:
          type: number
        costsByResourceTag:
          $ref: '#/components/schemas/CostsByResourceTag'
      required:
        - type
        - costsByResourceTag

    PlanObjectives:
      type: array
      items:
        oneOf:
            - $ref: '#/components/schemas/ObjectivesEnum'
            - $ref: '#/components/schemas/CustomObjective'
      default:
        - maximizeMandatoryStops
        - minimizeDelay
        - minimizeCosts
        - minimizeResources
        - minimizeOverOverlappingCapacitiesOnStops
        - maximizeOptionalStops
        - maximizePreferredStops
        - minimizeWorkingDuration
        - minimizeDistance

    ObjectivesEnum:
      type: string
      enum:
          - maximizeMandatoryStops
          - minimizeDelay
          - minimizeCosts
          - minimizeResources
          - minimizeOverOverlappingCapacitiesOnStops
          - maximizeOptionalStops
          - maximizePreferredStops
          - minimizeLargestTourDuration
          - minimizeWorkingDuration
          - minimizeDistance

    CostsByResourceTag:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/Cost'
    
    CustomObjective:
      type: object
      properties:
        type:
          type: string
          enum:
            - custom
        name:
          type: string
          not:
            type: string
            pattern: ^(maximizeMandatoryStops|minimizeDelay|minimizeCosts|minimizeResources|minimizeOverOverlappingCapacitiesOnStops|maximizeOptionalStops|maximizePreferredStops|minimizeLargestTourDuration|minimizeWorkingDuration|minimizeDistance)$
        direction:
          $ref: '#/components/schemas/OptimizationDirection'
        costsByResourceTag:
          $ref: '#/components/schemas/CostsByResourceTag'
      required:
        - type
        - name
        - direction
        - costsByResourceTag

    OptimizationDirection:
      type: string
      enum:
        - minimize
        - maximize

    Duration:
      type: string
      description: A period of time, expressed in the ISO8601 **duration** format.
      pattern: '^P(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(\d+H)?(\d+M)?(\d+S)?)?$'
      example: PT4M

    DateTime:
      type: string
      description: "A full calendar date time, expressed in the ISO8601 **date** format: YYYY-MM-DDThh:mm:ssZ."
      example: '2019-11-15T12:34:56Z'

    TimeZone:
      type: string
      description: |
        The time zone is a string code which identifies a region of the world in the "time zone database", also called "tz database".
        The tz database is a partition of the world into regions where local clocks all show the same time.
        This database gives the rules for time offset and daylight saving time in each region.
        
        How do we use it?
        
        In order to work with time events accurately, we usually use datetimes in the iso-8601 format, without explicit time zone.
        This format is quite well suported by many programming languages, and it is well suited for technical data exchange.
        But it is not easy to use for humans.
        
        For instance, here are three datetimes in iso-8601 format, which give the same exact moment in time:
        - "2025-05-22T05:43:00Z"
        - "2025-05-22T06:43:00+01:00"
        - "2025-05-22T07:43:00+02:00"
        
        For a non-technical user, it is difficult to know how to relate this to the time displayed on a watch or a clock.
        
        We improve the user experience by adding the support of local datetimes, thanks to the use of the time zone,
        which allows to transform a local datetime into an iso-8601 datetime:
        - local datetime + timezone (tz) = iso-8601 datetime
        
        For instance, here are five datetimes which all give the same exact moment in time:
        - "2025-05-22T05:43:00Z"
        - "2025-05-22T06:43:00+01:00"
        - "2025-05-22T07:43:00+02:00"
        - "2025-05-22 07:43:00"       + timezone "tz": "Europe/Paris"
        - "2025-05-22 07:43"          + timezone "tz": "Europe/Paris"
        
        Note: the last example ("2025-05-22 07:43") illustrates the support of local datetimes without seconds,
        which can be very practical for users.
        
        In order for local datetimes to be supported, some JSON input objects contain a "tz" time zone property.
        This "tz" property is used to pre-process the JSON input payload, like this:
        - We check if a valid timezone can be extracted from the "tz" property,
        - If so, we perform the following actions:
          - Walk through the whole JSON content to look for local datetimes,
          - Use the timezone to transform each local datetime into an iso-8601 datetime.
        
        Important: some objects contain a "properties" sub-object, which is a map of custom client data;
        the content of the "properties" sub-objects is always excluded from the time zone pre-processing.
      externalDocs:
        url: https://www.iana.org/time-zones
      example: Europe/Paris

    Position:
      type: object
      properties:
        lon:
          type: number
          minimum: -180
          maximum: 180
        lat:
          type: number
          minimum: -90
          maximum: 90
      required:
        - lon
        - lat
      example: { "lon": 2.3269331, "lat": 48.8812658 }

    FromPrevious:
      type: object
      description: The travel distance and duration from the previous waypoint to the current one.
      properties:
        travelDistanceInKm:
          type: number
        travelDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
      required:
        - travelDistanceInKm
        - travelDuration
      example:
        travelDistanceInKm: 2.3269331
        travelDuration: PT4M

    AtFirstPositionArrival:
      type: string
      description: The resource must go back to it's Tour first position.
      enum:
        - atFirstPosition

    Capacities:
      type: object
      additionalProperties:
        type: number
      example: { "volume": 9.5, "weight": 2200, "nbPackages": 23 }

    TaggedTimeWindow:
      type: object
      description: TimeWindow with resource tags.
      properties:
        begin:
          $ref: '#/components/schemas/DateTime'
        end:
          $ref: '#/components/schemas/DateTime'
        resourceTags:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: ["subcontractorA", "subcontractorB"]
      required:
        - begin
        - end

    TimeWindow:
      type: object
      properties:
        begin:
          $ref: '#/components/schemas/DateTime'
        end:
          $ref: '#/components/schemas/DateTime'
      required:
        - begin
        - end

    Break:
      oneOf:
        - $ref: '#/components/schemas/TimeWindowBreak'
        - $ref: '#/components/schemas/TravelDurationSlidingBreak'
        - $ref: '#/components/schemas/WorkingDurationSlidingBreak'

    TimeWindowBreak:
      type: object
      description: A required break of a given duration in a given time window.
      properties:
        type:
          type: string
          enum:
            - timeWindowBreak
        duration:
          allOf:
            - $ref: '#/components/schemas/Duration'
        timeWindow:
          allOf:
            - $ref: '#/components/schemas/TimeWindow'
      required:
        - duration
        - timeWindow

    TravelDurationSlidingBreak:
      type: object
      description: Limitation rule on max travel duration without any break.
      properties:
        type:
          type: string
          enum:
            - travelDurationSlidingBreak
        minBreakDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
        maxInterBreakDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
      required:
        - type
        - minBreakDuration
        - maxInterBreakDuration

    WorkingDurationSlidingBreak:
      type: object
      description: Limitation rule on max working duration without any break.
      properties:
        type:
          type: string
          enum:
            - workingDurationSlidingBreak
        minBreakDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
        maxInterBreakDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
      required:
        - type
        - minBreakDuration
        - maxInterBreakDuration

    OperationDurationPolicy:
      type: object
      description: Policy to indicate which operation duration must not be taken into account.
      properties:
        policy:
          type: string
          enum:
            - withoutFirstOperationDuration
            - withoutOperationDurations
        stopTags:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          uniqueItems: true
          example: [ "access:parking33", "capa:bat22", "setup:france" ]
      required:
        - policy

    CountryCode:
      type: string
      description: A country standard name or Alpha-2 code or Alpha-3 code.

    CountryCodes:
      type: array
      items:
        $ref: '#/components/schemas/CountryCode'
      example: ["Switzerland", "BE", "ITA"]

    VehicleProfileFly:
      type: object
      properties:
        type:
          type: string
          enum:
            - fly
        kmph:
          type: number
      required:
        - type

    VehicleProfilePedestrian:
      type: object
      properties:
        type:
          type: string
          enum:
            - pedestrian
        excludedCountries:
          $ref: '#/components/schemas/CountryCodes'

    VehicleProfileBicycle:
      type: object
      properties:
        type:
          type: string
          enum:
            - bicycle
        excludedCountries:
          $ref: '#/components/schemas/CountryCodes'
      required:
        - type

    VehicleProfileScooter:
      type: object
      properties:
        type:
          type: string
          enum:
            - scooter
        excludedCountries:
          $ref: '#/components/schemas/CountryCodes'
      required:
        - type

    VehicleProfileMotorbike:
      type: object
      properties:
        type:
          type: string
          enum:
            - motorbike
        excludedCountries:
          $ref: '#/components/schemas/CountryCodes'
      required:
        - type

    VehicleProfileCar:
      type: object
      properties:
        type:
          type: string
          enum:
            - car
        withTraffic:
          type: boolean
        excludedCountries:
          $ref: '#/components/schemas/CountryCodes'
      required:
        - type

    VehicleProfileTruck:
      type: object
      properties:
        type:
          type: string
          enum:
            - truck
        grossWeight:
          type: number
        withTraffic:
          type: boolean
        avoidTollRoad:
          type: boolean
        shippedHazardousGoods:
          type: array
          items:
            $ref: '#/components/schemas/ShippedHazardousGood'
          example: [ "explosive", "gas", "flammable" ]
        excludedCountries:
          $ref: '#/components/schemas/CountryCodes'
      required:
        - type

    ShippedHazardousGood:
      type: string
      enum:
        - explosive
        - gas
        - flammable
        - combustible
        - organic
        - poison
        - radioactive
        - corrosive
        - poisonousInhalation
        - harmfulToWater
        - other

    TaggedCostFloorsAndCoeffs:
      type: object
      allOf:
        - $ref: '#/components/schemas/CostFloorsAndCoeffs'
      properties:
        stopTags:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          uniqueItems: true
          example: ["warehouse", "stop"]

    CostFloorsAndCoeffs:
      type: object
      description: Cost floors and coefficients. A cost cannot be empty. An overcost cannot be set if there is no cost, and the overcostFloor must be greater than costFloor.
      properties:
        constantCost:
          type: number
        costFloor:
          type: number
        costCoeff:
          type: number
        overcostFloor:
          type: number
        overcostCoeff:
          type: number

    Cost:
      type: object
      properties:
        workedHours:
          $ref: '#/components/schemas/CostFloorsAndCoeffs'
        km:
          $ref: '#/components/schemas/CostFloorsAndCoeffs'
        using:
          type: number
        costsByStopTag:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/CostFloorsAndCoeffs'
        costsByCapacity:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/TaggedCostFloorsAndCoeffs'

    State:
      type: object
      properties:
        mode:
          $ref: '#/components/schemas/ResourceMode'
        assignments:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/AssignmentStop'
              - $ref: '#/components/schemas/AssignmentBegin'
              - $ref: '#/components/schemas/AssignmentBreak'
              - $ref: '#/components/schemas/AssignmentEnd'

    EnvelopedState:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/State'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    AssignmentStatus:
      type: string
      enum:
        - fixed
        - assigned
      default: fixed

    AssignmentStop:
      description: The beginTime is set to arrivalTime if not setted.
      type: object
      properties:
        type:
          type: string
          enum:
            - stop
        status:
          $ref: '#/components/schemas/AssignmentStatus'
        stopId:
          $ref: '#/components/schemas/RegexIdValidation'
        arrivalTime:
          $ref: '#/components/schemas/DateTime'
        beginTime:
          $ref: '#/components/schemas/DateTime'
        departureTime:
          $ref: '#/components/schemas/DateTime'
      required:
        - stopId
        - arrivalTime
        - departureTime

    AssignmentBegin:
      type: object
      properties:
        type:
          type: string
          enum:
            - begin
        status:
          $ref: '#/components/schemas/AssignmentStatus'
        departureTime:
          $ref: '#/components/schemas/DateTime'
      required:
        - type
        - departureTime

    AssignmentBreak:
      type: object
      properties:
        type:
          type: string
          enum:
            - break
        status:
          $ref: '#/components/schemas/AssignmentStatus'
        arrivalTime:
          $ref: '#/components/schemas/DateTime'
        departureTime:
          $ref: '#/components/schemas/DateTime'
      required:
        - type
        - arrivalTime
        - departureTime

    AssignmentEnd:
      type: object
      properties:
        type:
          type: string
          enum:
            - end
        status:
          $ref: '#/components/schemas/AssignmentStatus'
        arrivalTime:
          $ref: '#/components/schemas/DateTime'
      required:
        - type
        - arrivalTime

    ErrorProperties:
      type: object
      additionalProperties:
        type: string

    Error:
      type: object
      readOnly: true
      properties:
        code:
          type: string
        message:
          type: string
        properties:
          $ref: '#/components/schemas/ErrorProperties'
      required:
        - message
        - code

    EnvelopedErrors:
      type: object
      properties:
        errors:
          type: array
          items:
            $ref: '#/components/schemas/Error'

    Solution:
      type: object
      readOnly: true
      properties:
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'
        timestamp:
          allOf:
            - $ref: '#/components/schemas/DateTime'
        unaffectedStopIds:
          type: array
          uniqueItems: true
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
        unaffectedAlternativeIds:
          type: array
          uniqueItems: true
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
        unusedResourceIds:
          type: array
          uniqueItems: true
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
        objectives:
          type: array
          items:
            $ref: '#/components/schemas/SolutionObjective'
          example:
            - name: "maximizeMandatoryStops"
              priority: 1
              direction: "maximize"
              value: 232
            - name: "minimizeDelay"
              direction: "minimize"
              value: 3600
            - name: "minimizeResources"
              priority: 0
              direction: "minimize"
              value: 232
            - name: "maximizeOptionalStops"
              priority: 0
              direction: "maximize"
              value: 232
            - name: "minimizeLargestTourDuration"
              priority: 0
              direction: "minimize"
              value: 1000
            - name: "minimizeWorkingDuration"
              priority: 0
              direction: "minimize"
              value: 83430
            - name: "minimizeDistance"
              priority: 0
              direction: "minimize"
              value: 88232.4
        tours:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/Tour'
        totalDelay:
          description: Total delay of the solution related to the preferred time windows.
          allOf:
            - $ref: '#/components/schemas/Duration'
        globalViolations:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/GlobalViolationMaxCumulatedCost'

    EnvelopedSolution:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/Solution'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    SolutionObjective:
      type: object
      properties:
        name:
          type: string
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        priority:
          type: integer
        direction:
          $ref: '#/components/schemas/OptimizationDirection'
        value:
          type: number

    EnvelopedSolutionObjectives:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/SolutionObjective'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    Tour:
      type: object
      properties:
        resourceId:
          type: string
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        mode:
          $ref: '#/components/schemas/ResourceMode'
        distanceInKm:
          type: number
        tourCost:
          type: number
        totalDelay:
          description: Total delay of the tour related to the preferred time windows.
          allOf:
            - $ref: '#/components/schemas/Duration'
        travelDuration:
          $ref: '#/components/schemas/Duration'
        workingDuration:
          $ref: '#/components/schemas/Duration'
        waitingDuration:
          $ref: '#/components/schemas/Duration'
        resourceCapacities:
          description: List of capacities and associated quantity for which the resource has a restriction on the quantity to be carried at each stop during the tour.
          allOf:
            - $ref: '#/components/schemas/Capacities'
        maxFilledCapacities:
          description: List of each capacity transported by the resource, as well as the maximum quantity reached for this capacity at a stop during the tour.
          allOf:
            - $ref: '#/components/schemas/Capacities'
        filledCapacitiesAtBegin:
          $ref: '#/components/schemas/Capacities'
        filledCapacitiesAtEnd:
          $ref: '#/components/schemas/Capacities'
        isValid:
          description: Indicates whether the tour satisfies all resource constraints.
          type: boolean
        violations:
          type: array
          items:
            $ref: '#/components/schemas/TourViolation'
          description: List of the Tour's violations.
        wayPoints:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/WayPointBegin'
              - $ref: '#/components/schemas/WayPointStop'
              - $ref: '#/components/schemas/WayPointBreak'
              - $ref: '#/components/schemas/WayPointEnd'
        vehicleProfile:
          oneOf:
            - $ref: '#/components/schemas/VehicleProfileFly'
            - $ref: '#/components/schemas/VehicleProfilePedestrian'
            - $ref: '#/components/schemas/VehicleProfileBicycle'
            - $ref: '#/components/schemas/VehicleProfileScooter'
            - $ref: '#/components/schemas/VehicleProfileMotorbike'
            - $ref: '#/components/schemas/VehicleProfileCar'
            - $ref: '#/components/schemas/VehicleProfileTruck'

    GlobalViolationMaxCumulatedCost:
      type: object
      description: Violation linked to a MaxCumulatedCost global constraint.
      properties:
        type:
          type: string
          enum:
            - maxCumulatedCost
        name:
          type: string
        resourceIds:
          type: array
          uniqueItems: true
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
        maximum:
          type: number
        exceededCost:
          type: number

    TourViolation:
      description: Semantic violations, can be handled "generically" or specifically.
      oneOf:
          - $ref: '#/components/schemas/BeginViolation'
          - $ref: '#/components/schemas/EndViolation'
          - $ref: '#/components/schemas/SkillsViolation'
          - $ref: '#/components/schemas/ForbiddenAssignmentViolation'
          - $ref: '#/components/schemas/AuthorizedTimeWindowViolation'
          - $ref: '#/components/schemas/CapacityViolation'
          - $ref: '#/components/schemas/AtLeastOneValidCapacityViolation'
          - $ref: '#/components/schemas/SuccessiveStopsViolation'
          - $ref: '#/components/schemas/OrderViolation'
          - $ref: '#/components/schemas/MaxStopSpanViolation'
          - $ref: '#/components/schemas/WorkingTimeWindowViolation'
          - $ref: '#/components/schemas/MaxWorkingDurationViolation'
          - $ref: '#/components/schemas/MaxDistanceInKmViolation'
          - $ref: '#/components/schemas/StopIncompatibilityViolation'
          - $ref: '#/components/schemas/AtLeastOneConstraintViolation'
          - $ref: '#/components/schemas/MaxStopTagGroupsViolation'
          - $ref: '#/components/schemas/RemovalStrategyViolation'

    WaypointViolation:
      description: Semantic violations, can be handled "generically" or specifically.
      oneOf:
          - $ref: '#/components/schemas/BeginViolation'
          - $ref: '#/components/schemas/EndViolation'
          - $ref: '#/components/schemas/SkillsViolation'
          - $ref: '#/components/schemas/ForbiddenAssignmentViolation'
          - $ref: '#/components/schemas/AuthorizedTimeWindowViolation'
          - $ref: '#/components/schemas/CapacityViolation'
          - $ref: '#/components/schemas/AtLeastOneValidCapacityViolation'

    BeginViolation:
      type: object
      description: Violation of a warehouse Constraint at the begining of a Tour.
      properties:
        type:
          type: string
          description: The violation's type.
          enum:
            - begin
        wayPointIndex:
          type: integer
          description: The idx of the waypoint the violation applies to.
          example: 0
      required:
        - type

    EndViolation:
      type: object
      description: Violation of a warehouse Constraint at the end of a Tour.
      properties:
        type:
          type: string
          enum:
            - end
        wayPointIndex:
          type: integer
          description: The idx of the waypoint the violation applies to.
          example: 0
      required:
        - type

    SkillsViolation:
      type: object
      description: Violation of a Skill constraint.
      properties:
        type:
          type: string
          enum:
            - skills
        wayPointIndex:
          type: integer
          description: The idx of the waypoint the violation applies to.
          example: 0
        lackingSkills:
          type: array
          description: The list of skills needed to do the waypoint that the resource lacks.
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: [ "forklift", "truck" ]
      required:
        - type

    ForbiddenAssignmentViolation:
      type: object
      description: Violation of a ForbiddenAssignment constraint.
      properties:
        type:
          type: string
          enum:
            - forbiddenAssignment
        wayPointIndex:
          type: integer
          description: The idx of the waypoint the violation applies to.
          example: 0
        forbiddenAssignments:
          type: array
          items:
            $ref: '#/components/schemas/ForbiddenAssignment'
          description: The list of forbidden assignments that are violated with the waypoint assigned to the resource.
      required:
        - type

    AuthorizedTimeWindowViolation:
      type: object
      description: Violation of a stop's TimeWindow constraint.
      properties:
        type:
          type: string
          enum:
            - authorizedTimeWindow
        wayPointIndex:
          type: integer
          description: The idx of the waypoint the violation applies to.
          example: 0
        forbiddenWindow:
          description: The violated forbidden window.
          allOf:
            - $ref: '#/components/schemas/TimeWindow'
        actualTime:
          description: The time at which the waypoint is actually executed.
          allOf:
              - $ref: '#/components/schemas/DateTime'
      required:
        - type
        - forbiddenWindow
        - actualTime

    CapacityViolation:
      type: object
      description: Violation of a resource's capacity constraint.
      properties:
        type:
          type: string
          enum:
            - capacity
        wayPointIndex:
          type: integer
          description: The idx of the waypoint the violation applies to.
          example: 0
        capacity:
          type: string
          description: The capacity's name the constraint is linked to.
        overCapacity:
          description: The exceeding capacity.
          type: number
      required:
        - type
        - capacity
        - overCapacity

    AtLeastOneValidCapacityViolation:
      type: object
      description: Violation of a AtLeastOneValidCapacity constraint.
      properties:
        type:
          type: string
          enum:
            - atLeastOneValidCapacity
        wayPointIndex:
          type: integer
          description: The idx of the waypoint the violation applies to.
          example: 0
        name:
          description: The name of the AtLeastOneValidCapacity constraint the violation is linked to.
          type: string
        overCapacities:
          $ref: '#/components/schemas/Capacities'
      required:
        - type
        - name
        - overCapacities

    SuccessiveStopsViolation:
      type: object
      description: Violation of a order's succesive stops constraint.
      properties:
        type:
          type: string
          enum:
            - successiveStops
        expectedSuccessiveStopIds:
          description: The stop ids in the expected order.
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
        interleavedStopIds:
          description: The stop ids which are not expected and interleaved between the order stops.
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
      required:
        - type
        - expectedSuccessiveStopIds

    OrderViolation:
      type: object
      description: Violation of a order's stops constraint.
      properties:
        type:
          type: string
          enum:
            - order
        expectedOrderedStopIds:
          description: The stop ids in the expected order.
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
        missedStopIds:
          description: The stop ids missing from the tour.
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
        badlyOrderedStopIds:
          description: The stop ids badly ordered in the tour.
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
      required:
        - type
        - expectedOrderedStopIds

    MaxStopSpanViolation:
      type: object
      description: Violation of a order's MaxStopSpan constraint.
      properties:
        type:
          type: string
          enum:
            - maxStopSpan
        orderId:
          description: The order id with the MaxStopSpan constraint violation.
          type: string
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        delay:
          description: The delay that exceeds the MaxStopSpan.
          allOf:
            - $ref: '#/components/schemas/Duration'
      required:
        - type
        - orderId
        - delay

    WorkingTimeWindowViolation:
      type: object
      description: Violation of a resource's TimeWindow constraint.
      properties:
        type:
          type: string
          enum:
            - workingTimeWindow
        delay:
          description: The delay that exceeds the resource's TimeWindow.
          allOf:
            - $ref: '#/components/schemas/Duration'
      required:
        - type
        - delay

    MaxWorkingDurationViolation:
      type: object
      description: Violation of a resource's MaxWorkingDuration constraint.
      properties:
        type:
          type: string
          enum:
            - maxWorkingDuration
        maxWorkingDuration:
          description: The expected maximum working duration.
          allOf:
            - $ref: '#/components/schemas/Duration'
        exceededDuration:
          description: The duration that exceeds the maximum working duration.
          allOf:
            - $ref: '#/components/schemas/Duration'
      required:
        - type
        - maxWorkingDuration
        - exceededDuration

    MaxDistanceInKmViolation:
      type: object
      description: Violation of a resource's MaxDistanceInKm constraint.
      properties:
        type:
          type: string
          enum:
            - maxDistanceInKm
        maxDistanceInKm:
          description: The expected maximum distance, in km.
          type: number
        exceededDistanceInKm:
          description: The distance that exceeds the maximum distance, in km.
          type: number
      required:
        - type
        - maxDistanceInKm
        - exceededDistanceInKm

    StopIncompatibilityViolation:
      type: object
      description: Violation of a resource's StopIncompatibility constraint.
      properties:
        type:
          type: string
          enum:
            - stopIncompatibility
        name:
          description: The name of the StopIncompatibility constraint the violation is linked to.
          type: string
        incompatibilities:
          description: Lists of stop ids for each incompatible tag.
          type: array
          items:
            type: array
            items:
              allOf:
                - $ref: '#/components/schemas/RegexIdValidation'
              example: ["stop1", "stop2"]
            minItems: 2
            maxItems: 2
        tags:
          $ref: '#/components/schemas/StopTagPair'
      required:
        - type
        - incompatibilities
        - tags

    AtLeastOneConstraintViolation:
      type: object
      description: Violation of a resource's AtLeastOneConstraint constraint.
      properties:
        type:
          type: string
          enum:
            - atLeastOneConstraint
        name:
          description: The name of the AtLeastOneConstraint constraint the violation is linked to.
          type: string
        violatedConstraints:
          description: Lists of sub-constraints violations.
          type: array
          items:
            allOf:
              - $ref: '#/components/schemas/TourViolation'
      required:
        - type
        - name
        - violatedConstraints

    MaxStopTagGroupsViolation:
      type: object
      description: Violation of a resource's MaxStopTagGroups constraint.
      properties:
        type:
          type: string
          enum:
            - maxStopTagGroups
        name:
          description: The name of the MaxStopTagGroups constraint the violation is linked to.
          type: string
        exceededNbGroupsByStopTag:
          type: object
          description: The exceeded number of groups by stop tag.
          additionalProperties:
            $ref: '#/components/schemas/ExceededNbGroups'
      required:
        - type
        - exceededNbGroupsByStopTag

    ExceededNbGroups:
      type: object
      description: The maximum number of groups and its corresponding exceeding number of groups, for a stop tag.
      properties:
        maxAllowed:
          type: integer
          description: Maximum number of groups allowed.
          example: 2
          minimum: 0
        exceededNbGroups:
          type: integer
          description: Number of groups that exceeds the maximum number allowed.
          example: 2
          minimum: 1
      required:
        - maxAllowed
        - exceededNbGroups

    RemovalStrategyViolation:
      type: object
      description: Violation of a resource's RemovalStrategy constraint.
      properties:
        type:
          type: string
          enum:
            - removalStrategy
        name:
          description: The name of the RemovalStrategy constraint the violation is linked to.
          type: string
        removalStrategyType:
          allOf:
            - $ref: '#/components/schemas/RemovalStrategyType'
      required:
        - type
        - removalStrategyType

    RemovalStrategyType:
      type: string
      enum:
        - lifo
      default: lifo

    WayPointStatus:
      type: string
      enum:
        - fixed
        - assigned
        - optimized
      default: fixed

    WayPointBegin:
      type: object
      properties:
        type:
          type: string
          enum:
            - begin
        position:
          $ref: '#/components/schemas/Position'
        status:
          example: fixed
          allOf:
            - $ref: '#/components/schemas/WayPointStatus'
        departureTime:
          $ref: '#/components/schemas/DateTime'
        violations:
          type: array
          items:
            $ref: '#/components/schemas/WaypointViolation'
          description: List of the Waypoint's violations.
        fromPrevious:
          $ref: '#/components/schemas/FromPrevious'
      required:
        - type
        - position

    WayPointStop:
      type: object
      properties:
        type:
          type: string
          enum:
            - stop
        stopId:
          type: string
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        position:
          $ref: '#/components/schemas/Position'
        status:
          example: optimized
          allOf:
            - $ref: '#/components/schemas/WayPointStatus'
        stopProperties:
          $ref: '#/components/schemas/Properties'
        orderProperties:
          $ref: '#/components/schemas/Properties'
        filledCapacitiesAfterStop:
          $ref: '#/components/schemas/Capacities'
        delay:
          description: Delay related to the stop's preferred time windows.
          allOf:
            - $ref: '#/components/schemas/Duration'
        arrivalTime:
          $ref: '#/components/schemas/DateTime'
        beginTime:
          $ref: '#/components/schemas/DateTime'
        departureTime:
          $ref: '#/components/schemas/DateTime'
        violations:
          type: array
          items:
            $ref: '#/components/schemas/WaypointViolation'
          description: List of the Waypoint's violations.
        fromPrevious:
          $ref: '#/components/schemas/FromPrevious'
        stopKind:
          $ref: '#/components/schemas/StopKind'
      required:
        - type
        - position

    WayPointBreak:
      type: object
      properties:
        type:
          type: string
          enum:
            - break
        status:
          example: optimized
          allOf:
            - $ref: '#/components/schemas/WayPointStatus'
        arrivalTime:
          $ref: '#/components/schemas/DateTime'
        departureTime:
          $ref: '#/components/schemas/DateTime'
        violations:
          type: array
          items:
            $ref: '#/components/schemas/WaypointViolation'
          description: List of the Waypoint's violations.
        fromPrevious:
          $ref: '#/components/schemas/FromPrevious'
      required:
        - type

    WayPointEnd:
      type: object
      properties:
        type:
          type: string
          enum:
            - end
        position:
          $ref: '#/components/schemas/Position'
        status:
          allOf:
            - $ref: '#/components/schemas/WayPointStatus'
          example: optimized
        arrivalTime:
          $ref: '#/components/schemas/DateTime'
        violations:
          type: array
          items:
            $ref: '#/components/schemas/WaypointViolation'
          description: List of the Waypoint's violations.
        fromPrevious:
          $ref: '#/components/schemas/FromPrevious'
      required:
        - type
        - position

    AdditionalConstraintIncompatibleStopTags:
      type: object
      description: Incompatibility between stop tags.
      properties:
        type:
          type: string
          enum:
            - incompatibleStopTags
        name:
          type: string
        stopTags:
          $ref: '#/components/schemas/StopTagPair'
        resourceTags:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: ["subcontractorA", "subcontractorB"]
      required:
        - type
        - stopTags

    AdditionalConstraintForbiddenAssignment:
      type: object
      description: Forbidden assignment by stop tag and resource tag.
      properties:
        type:
          type: string
          enum:
            - forbiddenAssignment
        name:
          type: string
        resourceTag:
          type: string
          description: Resource tag.
          example: trailer
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        stopTag:
          type: string
          description: Stop tag.
          example: heavy
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
      required:
        - type
        - resourceTag
        - stopTag

    AdditionalConstraintAtLeastOneValidCapacity:
      type: object
      description: If the tour has not, at each stop, one of its capacities lower than or equal to the link limit, then the tour is invalid.
      properties:
        type:
          type: string
          enum:
            - atLeastOneValidCapacity
        name:
          type: string
        capacities:
          $ref: '#/components/schemas/Capacities'
        resourceTags:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: ["subcontractorA", "subcontractorB"]
      required:
        - type
        - capacities

    AdditionalConstraintAtLeastOneConstraint:
      type: object
      description: If one of the constraint is valid, then the tour is valid.
      properties:
        type:
          type: string
          enum:
            - atLeastOneConstraint
        name:
          type: string
        constraints:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/AdditionalConstraintAtLeastOneValidCapacity'
              - $ref: '#/components/schemas/AdditionalConstraintForbiddenAssignment'
              - $ref: '#/components/schemas/AdditionalConstraintIncompatibleStopTags'
              - $ref: '#/components/schemas/AdditionalConstraintAtLeastOneConstraint'
              - $ref: '#/components/schemas/AdditionalConstraintCapacities'
              - $ref: '#/components/schemas/AdditionalConstraintMaxStopTagGroups'
              - $ref: '#/components/schemas/AdditionalConstraintRemovalStrategy'
      required:
         - type
         - constraints

    AdditionalConstraintCapacities:
      type: object
      description: This constraint is valid if all the capacities are satisfied.
      properties:
        type:
          type: string
          enum:
            - capacities
        name:
          type: string
        capacities:
          $ref: '#/components/schemas/Capacities'
        resourceTag:
          type: string
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
      required:
         - type
         - capacities
         - resourceTag

    AdditionalConstraintMaxStopTagGroups:
      type: object
      description: If the tour has stops whose stopTags constitute too many groups, then the tour is invalid.
      properties:
        type:
          type: string
          enum:
            - maxStopTagGroups
        name:
          type: string
        resourceTags:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: ["subcontractorA", "subcontractorB"]
        maxGroupsByStopTag:
          $ref: '#/components/schemas/MaxGroupsByStopTag'

      required:
        - type
        - maxGroupsByStopTag

    MaxGroupsByStopTag:
      type: object
      additionalProperties:
        type: integer
      example: { "depot": 2, "delivery": 10 }

    AdditionalConstraintRemovalStrategy:
      type: object
      description: If the tour does not respect the defined removal strategy, then the tour is invalid.
      properties:
        type:
          type: string
          enum:
            - removalStrategy
        name:
          type: string
        resourceTags:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: ["subcontractorA", "subcontractorB"]
        capacities:
          type: array
          items:
            type: string
            allOf:
              - $ref: '#/components/schemas/RegexIdValidation'
          example: ["volume", "length"]
        removalStrategy:
          type: string
          allOf:
            - $ref: '#/components/schemas/RemovalStrategyType'
          example: "lifo"

      required:
        - type

    Paging:
      type: object
      properties:
        total:
          type: integer
          readOnly: true
          description: The total number of items in the requested collection.
          example: 142
        totalPages:
          type: integer
          readOnly: true
          description: The total number of pages in the requested collection.
          example: 5
        page:
          type: integer
          readOnly: true
          description: The current page of items.
          example: 2
        nextPage:
          type: integer
          readOnly: true
          description: The next available page of items.
          nullable: true
          example: 3
        previousPage:
          type: integer
          readOnly: true
          description: The previous page of items.
          nullable: true
          example: 1
        itemsPerPage:
          type: integer
          readOnly: true
          default: 20
          maximum: 100
          description: The number of items per page, set internally or by the request.
          example: 30

    ScoredTimeWindow:
      type: object
      properties:
        timeWindow:
          $ref: '#/components/schemas/TimeWindow'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'
        objectives:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/SolutionObjective'
        initialObjectives:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/SolutionObjective'
        solutionTimestamp:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        resourceId:
          type: string
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        beginTime:
          $ref: '#/components/schemas/DateTime'
      required:
        - timeWindow
        - objectives

    SMAOrder:
      allOf:
        - $ref: '#/components/schemas/Order'
        - type: object
          properties:
            stops:
              type: array
              items:
                $ref: '#/components/schemas/Stop'
              minItems: 1
              maxItems: 1

    SMAInput:
      type: object
      properties:
        order:
          $ref: '#/components/schemas/SMAOrder'
        maxNbPropositions:
          type: integer
          nullable: true
          minimum: 1
          maximum: 255
        timeWindows:
          type: array
          uniqueItems: true
          items:
            $ref: '#/components/schemas/TimeWindow'
          minItems: 1
        tz:
          $ref: '#/components/schemas/TimeZone'
      required:
        - order
        - timeWindows

    SMAMultiPlanInput:
      allOf:
        - $ref: '#/components/schemas/SMAInput'
        - type: object
          properties:
            planIds:
              type: array
              uniqueItems: true
              items:
                type: string
              example: [ "plan-a", "plan-b", "plan-c" ]
      required:
        - order
        - timeWindows
        - planIds

    EnvelopedSMAOutput:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ScoredTimeWindow'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'

    OTPType:
      type: string
      enum: [ "none", "email", "sms", "totp" ]
      default: "none"
      example: "sms"
      description: Type of OTP (One-Time Password).

    EnvelopedOTPType:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/OTPType'

    OTPValue:
      type: string
      description: A 6-digits OTP code.
      example: "403852"

    PhoneNumber:
      type: string
      description: Phone number in E.164 international format (e.g., +33612345678).
      pattern: '^\+[1-9]\d{1,14}$'
      example: "+33612345678"

    ObfuscatedPhoneNumber:
      type: string
      description: An obfuscated representation of the phone number used for MFA
      nullable: true
      example: "+336*******8"

    TOTPConfig:
      type: object
      nullable: true
      properties:
        secret:
          type: string
          example: J5GEMOCTHFLDER22JU3DIRKDJJMEOOJZ
          description: A 32-characters secret code.
        url:
          type: string
          example: "otpauth://totp/Kardinal:foobar?algorithm=SHA1&digits=6&issuer=Kardinal&period=30&secret=J5GEMOCTHFLDER22JU3DIRKDJJMEOOJZ"
          description: The TOTP auth protocol url.

    BackupCode:
      type: string
      description: A unique 16-characters backup code.
      maxLength: 16
      minLength: 16
      example: "E0ZE97NY1Z6WAW1L"

    BackupCodes:
      type: array
      description: A list of 10 unique 16-characters backup codes.
      maxItems: 10
      minItems: 10
      items:
        $ref: '#/components/schemas/BackupCode'
      example: [
        "E0ZE97NY1Z6WAW1L",
        "064M3TCQTR5B2Q74",
        "6BMR618ZH8CJ1WM5",
        "8ERR9CPIUL6FWB95",
        "I8I09DQL5KHRS06A",
        "NEGSE5TJGXCV2Z2G",
        "3XHWOE9DXL1YLKW1",
        "VKWE0RN8RO3WXSMR",
        "VV7U19AF4X1NSE83",
        "V5DT0YG81DRXISEY"
      ]

    EnvelopedBackupCodes:
      type: object
      properties:
        items:
          $ref: '#/components/schemas/BackupCodes'

    MFAConfig:
      type: object
      properties:
        updatedAt:
          description: The config's last update date.
          nullable: false
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        preferredType:
          $ref: '#/components/schemas/OTPType'
        availableTypes:
          description: The list of OTP types which have been configured by the actor in his MFA configuration.
          type: array
          readOnly: true
          items:
            $ref: '#/components/schemas/OTPType'
          example: [ "email", "sms", "totp" ]
        email:
          $ref: '#/components/schemas/ObfuscatedEmail'
        phoneNumber:
          $ref: '#/components/schemas/ObfuscatedPhoneNumber'
        totpConfig:
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/TOTPConfig'
        backupCodes:
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/BackupCodes'

    EnvelopedMFAConfig:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/MFAConfig'

    MFAConfigRegenerateBackupCodes:
      type: object
      description: A request to regenerate the MFA's backup codes.
      properties:
        password:
          $ref: '#/components/schemas/Password'
      required:
        - password

    MFAConfigRequestEmail:
      type: object
      description: A request to update or disable the OTP type "email" in the user's MFA configuration.
      properties:
        otpType:
          type: string
          enum: [ "email" ]
        email:
          $ref: '#/components/schemas/Email'
        password:
          $ref: '#/components/schemas/Password'
      required:
        - otpType
        - email
        - password

    MFAConfigRequestSMS:
      type: object
      description: A request to update or disable the OTP type "sms" in the user's MFA configuration.
      properties:
        otpType:
          type: string
          enum: [ "sms" ]
        phoneNumber:
          $ref: '#/components/schemas/PhoneNumber'
        password:
          $ref: '#/components/schemas/Password'
      required:
        - otpType
        - phoneNumber
        - password

    MFAConfigRequestTOTP:
      type: object
      description: A request to update or disable the OTP type "totp" in the user's MFA configuration.
      properties:
        otpType:
          type: string
          enum: [ "totp" ]
        password:
          $ref: '#/components/schemas/Password'
      required:
        - otpType
        - password

    MFAConfigResendEmail:
      type: object
      description: A request to resend the OTP code for the OTP type "email" during the user's MFA configuration.
      properties:
        otpType:
          type: string
          enum: [ "email" ]
        email:
          $ref: '#/components/schemas/Email'
      required:
        - otpType
        - email

    MFAConfigResendSMS:
      type: object
      description: A request to resend the OTP code for the OTP type "sms" during the user's MFA configuration.
      properties:
        otpType:
          type: string
          enum: [ "sms" ]
        phoneNumber:
          $ref: '#/components/schemas/PhoneNumber'
      required:
        - otpType
        - phoneNumber

    MFAConfigValidationEmail:
      type: object
      description: A validation of the update of the OTP type "email" in the user's MFA configuration.
      properties:
        otpType:
          type: string
          enum: [ "email" ]
        email:
          $ref: '#/components/schemas/Email'
        otp:
          $ref: '#/components/schemas/OTPValue'
      required:
        - otpType
        - email
        - otp

    MFAConfigValidationSMS:
      type: object
      description: A validation of the update of the OTP type "sms" in the user's MFA configuration.
      properties:
        otpType:
          type: string
          enum: [ "sms" ]
        phoneNumber:
          $ref: '#/components/schemas/PhoneNumber'
        otp:
          $ref: '#/components/schemas/OTPValue'
      required:
        - otpType
        - phoneNumber
        - otp

    MFAConfigValidationTOTP:
      type: object
      description: A validation of the update of the OTP type "totp" in the user's MFA configuration.
      properties:
        otpType:
          type: string
          enum: [ "totp" ]
        otp:
          $ref: '#/components/schemas/OTPValue'
      required:
        - otpType
        - otp

    EnvelopedMFARequestOTPOutput:
      type: object
      description: A JWT token with scope 'otp' valid for 10 minutes.
      properties:
        item:
          type: object
          properties:
            otpToken:
              $ref: '#/components/schemas/OTPToken'

    EnvelopedMFARequestTOTPOutput:
      type: object
      description: A JWT token with scope 'otp' valid for 10 minutes, together with a TOTP config.
      properties:
        item:
          type: object
          properties:
            otpToken:
              $ref: '#/components/schemas/OTPToken'
            totpConfig:
              $ref: '#/components/schemas/TOTPConfig'

    LoginBackupCodeInput:
      type: object
      description: Provides a backup code to fulfill the login.
      properties:
        backupCode:
          $ref: '#/components/schemas/BackupCode'
      required:
       - backupCode

    LoginOTPInput:
      type: object
      description: Provides the OTP code to fulfill the login.
      properties:
        otp:
          $ref: '#/components/schemas/OTPValue'
      required:
       - otp

    LoginOTPOutput:
      type: object
      properties:
        otpToken:
          type: string
          description: A JWT token with scope 'otp' valid for 10 minutes.
          example: "eyJhbGciOiJFZERTQSJ9.eyJhdWQiOlsiYXBpIiwiZnJvbnQiXSwiZXhwIjoxNzI3OTU3NjM2LCJpYXQiOjE3Mjc5NTcwMzYsImlzcyI6ImthcmRpbmFsLmp3dCIsIm5iZiI6MTcyNzk1NzAzNSwib3RwVHlwZSI6ImVtYWlsIiwic2NvcGUiOiJvdHAiLCJzdWIiOiJzb21lQG9uZS5jb20ifQ.Urhz2i-b_j5kb-Sa_GwyYrZusDtPpCmzUxLqo3EHi_bK0Gpx3cfov4rouE9XCH-HcaT4l16hot2Nkt31QwOJAQ"
        preferredType:
          $ref: '#/components/schemas/OTPType'
        availableTypes:
          description: The list of OTP types which have been configured by the actor in his MFA configuration
          type: array
          readOnly: true
          items:
            $ref: '#/components/schemas/OTPType'
          example: [ "email", "sms", "totp" ]
        email:
          $ref: '#/components/schemas/ObfuscatedEmail'
        phoneNumber:
          $ref: '#/components/schemas/ObfuscatedPhoneNumber'

    EnvelopedLoginOTPOutput:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/LoginOTPOutput'

    GlobalTravelTimeCoefficient:
      description: The value by which we multiply the global travel time.
      type: number
      default: 1.0
      minimum: 0.2
      maximum: 5.0
      example: 1.5

    EnvelopedGlobalTravelTimeCoefficient:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/GlobalTravelTimeCoefficient'
        agencyId:
          $ref: '#/components/schemas/AgencyId'

    UUID:
      type: string
      format: uuid
      description: Universally Unique Identifier.
      pattern: '^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$'
      example: cd4ce4e3-0208-4b10-b346-25f235214e4f
      readOnly: true

    AgencyWebhook:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        url:
          type: string
          description: The secure webhook URL (must be https).
          example: https://mydomain.com/webhooks
          format: uri
        headers:
          type: object
          description: A map of header key-value pairs.
          additionalProperties:
            type: string
          example:
            Authorization: "Bearer your_token"
            X-Custom-Header: "custom_value"
        withPlan:
          type: boolean
          description: Specifies whether we should also provide the plan in the webhook's payload.
          example: true
          default: false
        active:
          type: boolean
          description: Specifies whether the webhook is active or not.
          example: false
          default: true
        createdAt:
          description: The webhook's creation date.
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        updatedAt:
          description: The webhook's last update date.
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        expiresAt:
          description: The webhook's expiration date.
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'

    PlanWebhook:
      allOf:
        - $ref: '#/components/schemas/AgencyWebhook'
        - type: object
          properties:
            planId:
              $ref: '#/components/schemas/PlanId'

    EnvelopedAgencyWebhook:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/AgencyWebhook'
        agencyId:
          $ref: '#/components/schemas/AgencyId'

    EnvelopedAgencyWebhooks:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AgencyWebhook'
        agencyId:
          $ref: '#/components/schemas/AgencyId'

    EnvelopedPlanWebhook:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/PlanWebhook'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'

    EnvelopedPlanWebhooks:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PlanWebhook'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'

    WebhookCreate:
      type: object
      properties:
        url:
          type: string
          description: The secure webhook URL (must be https).
          example: https://mydomain.com/webhooks
          format: uri
        headers:
          type: object
          description: A map of header key-value pairs.
          additionalProperties:
            type: string
          example:
            Authorization: "Bearer your_token"
            X-Custom-Header: "custom_value"
        withPlan:
          type: boolean
          description: Specifies whether we should also provide the plan in the webhook's payload.
          example: true
          default: false
        ttl:
          type: string
          description: |
            Defines the webhook's time to live in iso 8601 duration format.
            The value should be at least 30 minutes and at most 14 days.
          pattern: '^P(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(\d+H)?(\d+M)?(\d+S)?)?$'
          example: PT1H
          default: PT30M
      required:
        - url

    WebhookUpdate:
      type: object
      properties:
        url:
          type: string
          description: The secure webhook URL (must be https).
          example: https://mydomain.com/webhooks
          format: uri
        headers:
          type: object
          description: A map of header key-value pairs.
          additionalProperties:
            type: string
          example:
            Authorization: "Bearer your_token"
            X-Custom-Header: "custom_value"
        withPlan:
          type: boolean
          description: Specifies whether we should also provide the plan in the webhook's payload.
          example: true
          default: false
        active:
          type: boolean
          description: Specifies whether the webhook is active or not.
          example: false
          default: true
      required:
        - url

    AgencyWebhookResult:
      type: object
      properties:
        webhookId:
          $ref: '#/components/schemas/UUID'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        statusCode:
          type: number
          description: The HTTP status code from the webhook's response.
          example: 200
        timestamp:
          $ref: '#/components/schemas/DateTime'
        inputSize:
          type: number
          description: The webhook's input payload size in KB.
          example: 2.3
        outputSize:
          type: number
          description: The webhook's output payload size in KB.
          example: 0.5
        tryNumber:
          type: number
          description: |
            The try number of calling the webhook:
             - 1: This is the first time we are calling the webhook.
             - greater than 1: Calling the webhook failed at least once and we are re-trying.
          example: 2
          minimum: 1

    PlanWebhookResult:
      allOf:
        - $ref: '#/components/schemas/AgencyWebhookResult'
        - type: object
          properties:
            planId:
              $ref: '#/components/schemas/PlanId'
            planVersion:
              $ref: '#/components/schemas/PlanVersion'

    EnvelopedAgencyWebhookResults:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AgencyWebhookResult'
        agencyId:
          $ref: '#/components/schemas/AgencyId'

    EnvelopedPlanWebhookResults:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/PlanWebhookResult'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'


    ## TARO schemas

    PointCoordinates:
      type: array
      description: GPS coordinates of a point, represented as an array containing the longitude and the latitude (in that order)
      items:
        type: number
      minItems: 2
      maxItems: 2
      example: [ 3.45545, 47.46687 ]

    LinearRingCoordinates:
      type: array
      description: |
        A linear ring is a closed line string with 4 or more positions:
        the first and last positions are equivalent, they represent equivalent points.
      items:
        $ref: '#/components/schemas/PointCoordinates'
      minItems: 4
      example: [
        [ 3.61610, 47.47681 ],
        [ 3.45545, 47.46687 ],
        [ 3.49480, 47.52560 ],
        [ 3.61610, 47.47681 ]
      ]

    PolygonCoordinates:
      type: array
      description: |
        A polygon is an array of linear rings:
        the first linear ring defines the outer ring of the polygon, the subsequent linear rings define interior holes.
      items:
        $ref: '#/components/schemas/LinearRingCoordinates'
      minItems: 1
      example: [
        [
          [ 3.28006, 47.62284 ],
          [ 3.26699, 47.38364 ],
          [ 3.48332, 47.16015 ],
          [ 3.79628, 47.19804 ],
          [ 3.90395, 47.30373 ],
          [ 3.89146, 47.54433 ],
          [ 3.58337, 47.72016 ],
          [ 3.28006, 47.62284 ]
        ],
        [
          [ 3.61610, 47.47681 ],
          [ 3.45545, 47.46687 ],
          [ 3.49480, 47.52560 ],
          [ 3.61610, 47.47681 ]
        ]
      ]

    MultiPolygonCoordinates:
      type: array
      description: A multi polygon is an array of polygons.
      items:
        $ref: '#/components/schemas/PolygonCoordinates'
      minItems: 1

    FeatureType:
      type: string
      enum:
        - Feature
      example: Feature

    MultiPolygonType:
      type: string
      enum:
        - MultiPolygon
      example: MultiPolygon

    MultiPolygon:
      type: object
      description: A GeoJSON MultiPolygon geometry
      externalDocs:
        url: https://datatracker.ietf.org/doc/html/rfc7946#section-3.1.7
      properties:
        type:
          $ref: '#/components/schemas/MultiPolygonType'
        coordinates:
          $ref: '#/components/schemas/MultiPolygonCoordinates'
      required:
        - type
        - coordinates

    MultiPolygonFeature:
      type: object
      description: A GeoJSON Feature containing a MultiPolygon geometry
      externalDocs:
        url: https://datatracker.ietf.org/doc/html/rfc7946#section-3.2
      properties:
        type:
          $ref: '#/components/schemas/FeatureType'
        geometry:
          $ref: '#/components/schemas/MultiPolygon'
        properties:
          type: object
      required:
        - type
        - geometry

    SectorMapping:
      type: object
      description: |
        A sector mapping consists in GeoJSON MultiPolygon features, mapped by sector names (one multipolygon per sector name):
        each multipolygon defines a geographical sector associated with a name.

        When a sector mapping exists in an agency, it is applied on every incoming ARO plan which fulfills the following condition:
        - Each plan order contains one and only one stop.

        If the condition is fulfilled, the sector mapping is applied as follows:
        - For each stop in the plan, we check whether the stop position is contained inside a sector (a multipolygon) of the sector mapping,
        - If so, we check whether the sector name is a prefix for a resource id of the plan,
        - If so, we set the resource mode to "fixed", and we push the stop inside the resource assignments, with the status "assigned".

        Once done, the plan follows the rest of the usual ARO process.

        Note: if an error occurs during this process, we abort the application of the sector mapping,
        and the plan simply goes on with the usual ARO process.
      additionalProperties:
        $ref: '#/components/schemas/MultiPolygonFeature'
      example:
        "resource-42":
          type: Feature
          geometry:
            type: MultiPolygon
            coordinates: [
              [
                [
                  [ 3.28006, 47.62284 ],
                  [ 3.26699, 47.38364 ],
                  [ 3.48332, 47.16015 ],
                  [ 3.79628, 47.19804 ],
                  [ 3.90395, 47.30373 ],
                  [ 3.89146, 47.54433 ],
                  [ 3.58337, 47.72016 ],
                  [ 3.28006, 47.62284 ]
                ],
                [
                  [ 3.61610, 47.47681 ],
                  [ 3.45545, 47.46687 ],
                  [ 3.49480, 47.52560 ],
                  [ 3.61610, 47.47681 ]
                ]
              ],
              [
                [
                  [ 4.12625, 47.58621 ],
                  [ 3.89271, 47.54398 ],
                  [ 3.90217, 47.37509 ],
                  [ 4.16784, 47.34288 ],
                  [ 4.26204, 47.45491 ],
                  [ 4.12625, 47.58621 ]
                ]
              ]
            ]
        "resource-84":
          type: Feature
          geometry:
            type: MultiPolygon
            coordinates: [
              [
                [
                  [ 3.90281, 47.37286 ],
                  [ 3.90794, 47.30384 ],
                  [ 3.76132, 47.16138 ],
                  [ 4.05518, 47.18665 ],
                  [ 4.24260, 47.33193 ],
                  [ 3.90281, 47.37286 ]
                ]
              ],
              [
                [
                  [ 4.24152, 47.33049 ],
                  [ 4.05729, 47.18739 ],
                  [ 4.34904, 47.17607 ],
                  [ 4.36825, 47.27060 ],
                  [ 4.24152, 47.33049 ]
                ]
              ]
            ]

    EnvelopedSectorMapping:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/SectorMapping'
        agencyId:
          $ref: '#/components/schemas/AgencyId'

    SimpleResource:
      type: object
      properties:
        id:
          description: Resource ids must be unique within a plan.
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        capacities:
          $ref: '#/components/schemas/Capacities'
        departure:
          $ref: '#/components/schemas/Position'
        arrival:
          oneOf:
            - $ref: '#/components/schemas/Position'
            - $ref: '#/components/schemas/AtFirstPositionArrival'
        workingTimeWindow:
          $ref: '#/components/schemas/TimeWindow'
        maxWorkingDuration:
          $ref: '#/components/schemas/Duration'
        maxDistanceInKm:
          type: number
        breaks:
          type: array
          items:
            $ref: '#/components/schemas/Break'
      required:
        - id
        - workingTimeWindow

    SimpleStop:
      type: object
      properties:
        id:
          description: Single stop ids must be unique within a plan.
          allOf:
            - $ref: '#/components/schemas/RegexIdValidation'
        position:
          $ref: '#/components/schemas/Position'
        kind:
          $ref: '#/components/schemas/StopKind'
        operationDuration:
          allOf:
            - $ref: '#/components/schemas/Duration'
        capacities:
          allOf:
            - $ref: '#/components/schemas/Capacities'
        timeWindow:
          $ref: '#/components/schemas/TimeWindow'
      required:
        - id
        - position

    SimpleObjective:
      type: string
      enum:
        - minimizeResources
        - minimizeWorkingDuration
        - minimizeDistance
      default: minimizeResources

    SimplePlan:
      type: object
      description: A simple plan is a simplified representation of a plan, with simplified resources, simplified stops, and a simplified objective.
      properties:
        id:
          $ref: '#/components/schemas/UUID'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        version:
          $ref: '#/components/schemas/PlanVersion'
        state:
          $ref: '#/components/schemas/PlanState'
        resources:
          type: array
          items:
            $ref: '#/components/schemas/SimpleResource'
        stops:
          type: array
          items:
            $ref: '#/components/schemas/SimpleStop'
        objective:
          $ref: '#/components/schemas/SimpleObjective'
        tz:
          $ref: '#/components/schemas/TimeZone'
        lateDeparture:
          description: True if lateDeparture is requested for Resources, false otherwise.
          type: boolean
          default: false
        createdAt:
          description: The plan's creation datetime.
          nullable: false
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        updatedAt:
          description: The plan's last update datetime.
          nullable: true
          readOnly: true
          allOf:
            - $ref: '#/components/schemas/DateTime'
        archivedAt:
          description: "The plan's archiving datetime: if not null, the plan is archived."
          nullable: true
          readOnly: true
          example: null
          allOf:
            - $ref: '#/components/schemas/DateTime'
      required:
        - id
        - agencyId
        - resources

    EnvelopedSimplePlan:
      type: object
      properties:
        item:
          $ref: '#/components/schemas/SimplePlan'
        agencyId:
          $ref: '#/components/schemas/AgencyId'
        planId:
          $ref: '#/components/schemas/PlanId'
        planVersion:
          $ref: '#/components/schemas/PlanVersion'
